function Hermite_class(){var t,e,a=[];this.init=void(t=navigator.hardwareConcurrency||4),this.getCores=function(){return t},this.resample_auto=function(t,e,a,i,n){var s=this.getCores();window.Worker&&s>1?this.resample(t,e,a,i,n):(this.resample_single(t,e,a,!0),null!=n&&n())},this.resize_image=function(t,e,a,i,n){var s=document.getElementById(t),l=document.createElement("canvas");if(l.width=s.width,l.height=s.height,l.getContext("2d").drawImage(s,0,0),null==e&&null==a&&null!=i&&(e=s.width/100*i,a=s.height/100*i),null==a){var o=s.width/e;a=s.height/o}e=Math.round(e),a=Math.round(a);var d=function(){var t=l.toDataURL();s.width=e,s.height=a,s.src=t,t=null,l=null};null==n||1==n?this.resample(l,e,a,!0,d):(this.resample_single(l,e,a,!0),d())},this.resample=function(i,n,s,l,o){var d=i.width,r=i.height;n=Math.round(n);var u=r/(s=Math.round(s));if(a.length>0)for(h=0;h<t;h++)null!=a[h]&&(a[h].terminate(),delete a[h]);a=new Array(t);for(var c=i.getContext("2d"),f=[],p=2*Math.ceil(r/t/2),m=-1,h=0;h<t;h++){var g=m+1;if(!(g>=r)){m=g+p-1,m=Math.min(m,r-1);var v;v=Math.min(p,r-g),f[h]={},f[h].source=c.getImageData(0,g,d,p),f[h].target=!0,f[h].start_y=Math.ceil(g/u),f[h].height=v}}!0===l?(i.width=n,i.height=s):c.clearRect(0,0,d,r);var _=0;for(h=0;h<t;h++)if(null!=f[h].target){_++;var b=new Worker(e);a[h]=b,b.onmessage=function(t){_--;var e=t.data.core;a[e].terminate(),delete a[e];var i=Math.ceil(f[e].height/u);f[e].target=c.createImageData(n,i),f[e].target.data.set(t.data.target),c.putImageData(f[e].target,0,f[e].start_y),_<=0&&null!=o&&o()};var w={width_source:d,height_source:f[h].height,width:n,height:Math.ceil(f[h].height/u),core:h,source:f[h].source.data.buffer};b.postMessage(w,[w.source])}},e=window.URL.createObjectURL(new Blob(["(",function(){onmessage=function(t){for(var e=t.data.core,a=t.data.width_source,i=t.data.height_source,n=t.data.width,s=t.data.height,l=a/n,o=i/s,d=Math.ceil(l/2),r=Math.ceil(o/2),u=new Uint8ClampedArray(t.data.source),c=(u.length,n*s*4),f=new ArrayBuffer(c),p=new Uint8ClampedArray(f,0,c),m=0;m<s;m++)for(var h=0;h<n;h++){var g=4*(h+m*n),v=0,_=0,b=0,w=0,y=0,x=0,k=0,j=m*o,D=Math.floor(h*l),L=Math.ceil((h+1)*l),C=Math.floor(m*o),A=Math.ceil((m+1)*o);L=Math.min(L,a),A=Math.min(A,i);for(var I=C;I<A;I++)for(var O=Math.abs(j-I)/r,S=h*l,M=O*O,T=D;T<L;T++){var z=Math.abs(S-T)/d,N=Math.sqrt(M+z*z);if(!(N>=1)){var U=4*(T+I*a);k+=(v=2*N*N*N-3*N*N+1)*u[U+3],b+=v,u[U+3]<255&&(v=v*u[U+3]/250),w+=v*u[U],y+=v*u[U+1],x+=v*u[U+2],_+=v}}p[g]=w/_,p[g+1]=y/_,p[g+2]=x/_,p[g+3]=k/b}postMessage({core:e,target:p},[p.buffer])}}.toString(),")()"],{type:"application/javascript"})),this.resample_single=function(t,e,a,i){for(var n=t.width,s=t.height,l=n/(e=Math.round(e)),o=s/(a=Math.round(a)),d=Math.ceil(l/2),r=Math.ceil(o/2),u=t.getContext("2d"),c=u.getImageData(0,0,n,s),f=u.createImageData(e,a),p=c.data,m=f.data,h=0;h<a;h++)for(var g=0;g<e;g++){var v=4*(g+h*e),_=0,b=0,w=0,y=0,x=0,k=0,j=0,D=h*o,L=Math.floor(g*l),C=Math.ceil((g+1)*l),A=Math.floor(h*o),I=Math.ceil((h+1)*o);C=Math.min(C,n),I=Math.min(I,s);for(var O=A;O<I;O++)for(var S=Math.abs(D-O)/r,M=g*l,T=S*S,z=L;z<C;z++){var N=Math.abs(M-z)/d,U=Math.sqrt(T+N*N);if(!(U>=1)){var R=4*(z+O*n);j+=(_=2*U*U*U-3*U*U+1)*p[R+3],w+=_,p[R+3]<255&&(_=_*p[R+3]/250),y+=_*p[R],x+=_*p[R+1],k+=_*p[R+2],b+=_}}m[v]=y/b,m[v+1]=x/b,m[v+2]=k/b,m[v+3]=j/w}!0===i?(t.width=e,t.height=a):u.clearRect(0,0,n,s),u.putImageData(f,0,0)}}!function(t){if("undefined"==typeof LumiseDesign)return!1;window.URL=window.URL||window.webkitURL,window.lumise_create_thumbn=function(t){var e=new Image;e.onload=function(){let a=window.creatThumbnCanvas?window.creatThumbnCanvas:window.creatThumbnCanvas=document.createElement("canvas"),i=a.getContext("2d"),n=t.width?t.width:t.height*(this.naturalWidth/this.naturalHeight),s=t.height?t.height:t.width*(this.naturalHeight/this.naturalWidth),l=this.src.indexOf("image/jpeg")>-1?"jpeg":"png";_w=this.naturalHeight*(n/this.naturalWidth)>=s?n:this.naturalWidth*(s/this.naturalHeight),_h=n==_w?this.naturalHeight*(n/this.naturalWidth):s,a.width=this.width,a.height=this.height,"jpeg"==l&&(i.fillStyle=t.background?t.background:"#eee",i.fillRect(0,0,a.width,a.height)),i.drawImage(this,0,0),HERMITE.resample_single(a,_w,_h,!0),t.callback(a.toDataURL("image/"+l,100),this),delete i,delete a,delete e},e.src=t.source},window.lumise_validate_file=function(t){return-1!==["image/png","image/jpeg","image/svg+xml"].indexOf(t.type)&&!(t.size>25485760)},window.build_lumi=function(t,e){var a=200,i=e.naturalHeight/e.naturalWidth*200,n=(new Date).getTime(),s={stages:{lumise:{data:{objects:[null,null,{type:"image",originX:"center",originY:"center",left:100,top:i/2,width:a,height:i,fill:"rgb(0,0,0)",stroke:"",strokeWidth:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,scaleX:1,scaleY:1,angle:0,flipX:!1,flipY:!1,opacity:1,visible:!0,backgroundColor:"",fillRule:"nonzero",globalCompositeOperation:"source-over",skewX:0,skewY:0,crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",src:e.src,evented:!0,selectable:!0,filters:[],resizeFilters:[]}],background:"#ebeced",devicePixelRatio:2,product_color:"#00ff7f",limit_zone:{width:207.69375,height:332.31,top:0,left:0},edit_zone:{height:i,width:a,left:0,top:0,radius:"0"},product_width:500,product_height:500,screenshot:t},screenshot:t,edit_zone:{height:i,width:a,left:0,top:0,radius:"0"},updated:n,padding:[0,0]}},updated:n};return"data:application/octet-stream;base64,"+btoa(encodeURIComponent(JSON.stringify(s)))},window.triggerObjects={},window.trigger=function(t,e){var a;for(var i in t.events){if("function"==typeof t.events[i])a=t.events[i];else{if("function"!=typeof t[t.events[i]])continue;a=t[t.events[i]]}(i=i.split(",")).map((function(i){void 0===(i=i.split(":"))[1]&&(i[1]="click"),void 0!==e&&!0===e?""===i[0]?t.el.off(i[1]).on(i[1],t,a):t.el.find(i[0]).off(i[1]).on(i[1],t,a):""===i[0]?t.el.on(i[1],t,a):t.el.find(i[0]).on(i[1],t,a)}))}"function"==typeof t.init&&t.init({data:t}),void 0!==e&&(triggerObjects[e]=t)};var e,a=t=>{window.frameElement&&("open"==t?(window.frameElement.setAttribute("data-current-style",encodeURIComponent(window.frameElement.getAttribute("style"))),window.frameElement.setAttribute("data-full","true")):(window.frameElement.setAttribute("style",decodeURIComponent(window.frameElement.getAttribute("data-current-style"))),window.frameElement.removeAttribute("data-full")))},i=function(e){if("close"==e)return a("close"),t("#lumise-lightbox").remove();var i=t("div#lumise-product-page").width();i>=1e3&&(i=1e3);var n='<div id="lumise-lightbox" class="lumise-lightbox">\t\t\t\t\t\t\t<div id="lumise-lightbox-body">\t\t\t\t\t\t\t\t<div id="lumise-lightbox-content" style="min-width:'+i+'px">\t\t\t\t\t\t\t\t\t%content%\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t%footer%\t\t\t\t\t\t\t\t<a class="kalb-close" href="#close" title="Close">\t\t\t\t\t\t\t\t\t<svg enable-background="new 0 0 32 32" height="32px" id="close" version="1.1" viewBox="0 0 32 32" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M17.459,16.014l8.239-8.194c0.395-0.391,0.395-1.024,0-1.414c-0.394-0.391-1.034-0.391-1.428,0  l-8.232,8.187L7.73,6.284c-0.394-0.395-1.034-0.395-1.428,0c-0.394,0.396-0.394,1.037,0,1.432l8.302,8.303l-8.332,8.286  c-0.394,0.391-0.394,1.024,0,1.414c0.394,0.391,1.034,0.391,1.428,0l8.325-8.279l8.275,8.276c0.394,0.395,1.034,0.395,1.428,0  c0.394-0.396,0.394-1.037,0-1.432L17.459,16.014z" fill="#121313" id="Close"></path><g></g><g></g><g></g><g></g><g></g><g></g></svg>\t\t\t\t\t\t\t\t</a>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="kalb-overlay"></div>\t\t\t\t\t\t</div>',s=t.extend({width:1e3,footer:"",content:"",onload:function(){},onclose:function(){}},e);""!==s.footer&&(s.footer='<div id="lumise-lightbox-footer">'+s.footer+"</div>"),n=t(n.replace(/\%width\%/g,s.width).replace(/\%content\%/g,s.content).replace(/\%footer\%/g,s.footer)),t(".lumise-lightbox").remove(),t("body").append(n),s.onload(n),n.find("a.kalb-close,div.kalb-overlay").on("click",(function(e){s.onclose(n),a("close"),t(".lumise-lightbox").remove()})),a("open")},n=function(){var e=new FormData,a=!0;return t("input.lumise-upload-helper-inp").each((function(){var i=t(this),n=i.val();if(""!==n&&"design"!=i.attr("data-file")){if("font"==i.attr("data-file")){if(-1===n.indexOf("data:application/"))return}else if(-1===n.indexOf("data:image/"))return;a=!1,"true"!=i.attr("data-processing")&&(i.attr({"data-processing":"true"}),t("div.lumise_form_submit a.lumise_cancel").remove(),t('div.lumise_form_submit input[type="submit"]').hide().after('<button disabled="true" style="padding: 0 14px;margin-left:180px" class="lumise_cancel" id="lumise-form-submitting"><i class="fa fa-spin fa-spinner"></i> Uploading..</button>'),e.append(this.getAttribute("name"),new Blob([btoa(encodeURIComponent(n))])))}})),!1===a&&(e.append("action","upload_fields"),e.append("nonce","LUMISE_ADMIN:"+LumiseDesign.nonce),t.ajax({data:e,type:"POST",url:LumiseDesign.ajax,contentType:!1,processData:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var a=e.loaded/e.total,i='<i class="fa fa-spin fa-spinner"></i>  '+parseInt(100*a)+"% upload complete";1===a&&(i='<i class="fa fa-spin fa-refresh"></i> Submitting..'),t("#lumise-form-submitting").html(i)}}),!1),e},success:function(e,a){(e=JSON.parse(e)).error?alert(e.error):(files=JSON.parse(decodeURIComponent(e.success)),Object.keys(files).map((function(e){t('input.lumise-upload-helper-inp[name="'+e+'"]').val(files[e])})),t("input.lumise-upload-helper-inp").eq(0).closest("form").submit())}})),a};window.enjson=function(t){return btoa(encodeURIComponent(JSON.stringify(t)))},window.dejson=function(t){return JSON.parse(decodeURIComponent(atob(t)))},window.esc_html=function(t){return t.replace(/\"/g,"&quot;").replace(/\'/g,"&#39;").replace(/\>/g,"&gt;").replace(/\</g,"&lt;")},window.lumise={i:function(t){return LumiseDesign.js_lang[t.toString()]},filters:{},actions:{},add_filter:function(t,e){void 0===this.filters[t]&&(this.filters[t]=[]),"function"==typeof e&&this.filters[t].push(e)},apply_filter:function(t,e,a){return void 0!==this.filters[t]&&this.filters[t].map((function(t){"function"==typeof t&&(e=t(e,a))})),e},add_action:function(t,e){this.actions.add(t,e)},do_action:function(t,e){return this.actions.do(t,e)},product:{popup:t("#lumise-popup"),init:function(e){void 0!==e.bases&&(lumise.product.bases=e.bases),trigger({el:t("#lumise-product-page"),events:{".lumise-popup-content .close-pop":"close_popup","#lumise-product-form:submit":"before_submit","#lumise-popup":"popup_click",'#lumise-stages-wrp ul.lumise_tab_nav li[data-add="tab"]':"new_stage","#lumise-stages-upload-helper:change":"upload_image_helper","#lumise-stages-wrp .lumise_tab_nav_wrap":"is_stage_accord","#lumise-stages-wrp div.lumise_tab_nav_wrap>i[data-move]":"stage_accord","div.fill-base-color input:change":"fill_variation"},fill_variation:function(e){let a=t(this).closest("div.lumise-stages-wrp");a.find("div.fill-base-color input").val(this.value),a.find("div.lumise-stage-body .lumise-stage-design-view").css({background:this.value}).click(),a.find("div.lumise-stage-editzone").css({"border-color":lumise.invert_color(this.value)})},change_color:function(e){if("INPUT"===this.tagName)return lumise.invert_color(this.value),t("div.lumise-stage-body .lumise-stage-design-view").css({background:this.value});e.target.getAttribute("data-color")&&(lumise.invert_color(e.target.getAttribute("data-color")),t("div.lumise-stage-body .lumise-stage-design-view").css({background:e.target.getAttribute("data-color")}))},invert:function(e){t(".lumise-stage-editzone").css({"border-color":lumise.invert_color(e),color:lumise.invert_color(e)})},close_popup:function(e){t("#lumise-popup").hide(),a("close"),e.preventDefault()},before_submit:function(e){t(".lumise_field_printing").each((function(){var e={};t(this).find(".lumise_checkbox").each((function(){if(t(this).find("input.action_check").prop("checked")){var a=t(this).find("input.action_check").val().toString();t(this).find('.lumise_radios input[type="radio"]:checked').val();e["_"+a]=""}})),t(this).find("input.field-value").val(encodeURIComponent(JSON.stringify(e)))}));var a=lumise.product.get_stages(t("#lumise-stages-wrp")),i=lumise.product.get_variations();t("textarea#lumise-field-stages-inp").val(enjson(a)),t("textarea#lumise-field-variations-inp").val(enjson(i));var n=lumise.product.get_attributes();return Object.keys(n).map((function(t){if(["select","product_color","color","checkbox","radio"].indexOf(n[t].type)<0)return!0;n[t].values="string"==typeof n[t].values?JSON.parse(n[t].values):n[t].values})),t("textarea#lumise-field-attributes-inp").val(enjson(n)),!0},popup_click:function(i){var n=i.target.getAttribute("data-act"),s=i.target;if("lumise-popup"==i.target.id&&(n="close"),n)switch(n){case"close":return t(this).hide(),a("close"),i.preventDefault();case"base":var l=i.target.getAttribute("data-src"),o=i.target.getAttribute("data-source");lumise.product.set_image(l,o);break;case"upload":lumise.product.upload({max_width:5e3,max_height:5e3,max_size:{value:20485760,err_msg:e.lg+"\n\n"+e.ru},type:{value:["image/png","image/jpeg","image/svg+xml"],err_msg:e.tp+"\n\n"+e.ru},callback:function(e){var a=new FormData,i=t('#lumise-base-upload-progress div[data-view="uploading"]>span'),n=(new Date).getTime().toString(36);t("#lumise-base-upload-progress div[data-view]").addClass("hidden"),t('#lumise-base-upload-progress,#lumise-base-upload-progress div[data-view="uploading"]').removeClass("hidden"),a.append(n,new Blob([e])),a.append("action","upload_product_images"),a.append("nonce","LUMISE_ADMIN:"+LumiseDesign.nonce),a.append("vendor",window.parent&&window.parent.lumisejs&&!1===window.parent.lumisejs.is_admin?"true":"false"),i.html("Starting upload.."),t.ajax({data:a,type:"POST",url:LumiseDesign.ajax,contentType:!1,processData:!1,xhr:function(){var t=new window.XMLHttpRequest;return t.upload.addEventListener("progress",(function(t){if(t.lengthComputable){var e=t.loaded/t.total;e<1?i.html(parseInt(100*e)+"% complete"):i.html("Upload completed, processing..")}}),!1),t},success:function(e,a){if(t("#lumise-base-upload-progress div[data-view]").addClass("hidden"),0===e.indexOf("Error"))return t('#lumise-base-upload-progress div[data-view="fail"]').removeClass("hidden"),void alert(e);e=JSON.parse(e),t('#lumise-base-upload-progress div[data-view="success"]').removeClass("hidden").find("img").attr({src:lumise_upload_url+e[n],"data-src":e[n]}),t("#lumise-uploaded-bases").prepend('<li><img data-act="base" data-src="'+e[n]+'" data-source="uploads" src="'+lumise_upload_url+e[n]+'"><i class="fa fa-trash" title="Delete" data-act="delete" data-file="'+n+'.jpg"></i><span data-file="'+n+'.jpg" data-act="edit-name" data-name="'+n+'" title="Click to edit image name">'+n+' <i data-file="'+n+'.jpg" data-act="edit-name" data-name="'+n+'" class="fa fa-pencil"></i></span></li>')},error:function(){t("#lumise-base-upload-progress div[data-view]").addClass("hidden"),t('#lumise-base-upload-progress div[data-view="fail"]').removeClass("hidden"),alert("Error: could not upload images this time, please try again later")}})}}),i.preventDefault();break;case"use":l=t('#lumise-base-upload-progress div[data-view="success"] img').attr("data-src"),o="uploads";lumise.product.set_image(l,o);break;case"dismiss":t("#lumise-base-upload-progress").addClass("hidden");break;case"samples":t('#lumise-uploaded-bases,button[data-act="samples"],button[data-act="upload"]').addClass("hidden"),t('#lumise-sample-bases,button[data-act="uploaded"]').removeClass("hidden"),i.preventDefault();break;case"uploaded":t('#lumise-uploaded-bases,button[data-act="samples"],button[data-act="upload"]').removeClass("hidden"),t('#lumise-sample-bases,button[data-act="uploaded"]').addClass("hidden"),i.preventDefault();break;case"edit-name":var d=prompt("Enter new image name",s.getAttribute("data-name")),r=s.getAttribute("data-file");if(null===d||""===d)return;t.ajax({url:LumiseDesign.ajax,method:"POST",data:{nonce:"LUMISE_ADMIN:"+LumiseDesign.nonce,ajax:"backend",action:"edit_name_product_image",name:d,file:r,vendor:window.parent&&window.parent.lumisejs&&!1===window.parent.lumisejs.is_admin?"true":"false"},statusCode:{403:function(){alert(LumiseDesign.js_lang.error_403)}},success:function(e){if("I"==s.tagName){var a=t(s).clone();i=t(s).parent()}else{var i=t(s);a=i.find("i").clone()}i.html(d),i.append(a)}});break;case"delete":if(confirm(lumise.i(170))){r=i.target.getAttribute("data-file");var u=t(i.target).closest("li");u.attr({"data-act":"load-more","data-loading":"true"}).html('<i class="fa fa-spin fa-spinner fa-2x"></i><br>'+lumise.i("wait")),t.ajax({url:LumiseDesign.ajax,method:"POST",data:{nonce:"LUMISE_ADMIN:"+LumiseDesign.nonce,ajax:"backend",action:"delete_base_image",file:r.split("/").pop(),vendor:window.parent&&window.parent.lumisejs&&!1===window.parent.lumisejs.is_admin?"true":"false"},statusCode:{403:function(){alert(LumiseDesign.js_lang.error_403)}},success:function(t){"1"!=t&&alert(t),u.remove()}})}break;case"load-more":if("true"==i.target.getAttribute("data-loading"))return;i.target.innerHTML='<i class="fa fa-spin fa-spinner fa-2x"></i><br>'+lumise.i("wait"),i.target.setAttribute("data-loading","true"),t.ajax({url:LumiseDesign.ajax,method:"POST",data:{nonce:"LUMISE_ADMIN:"+LumiseDesign.nonce,ajax:"backend",action:"load_more_bases",limit:18,start:i.target.getAttribute("data-start"),vendor:window.parent&&window.parent.lumisejs&&!1===window.parent.lumisejs.is_admin?"true":"false"},statusCode:{403:function(){alert(LumiseDesign.js_lang.error_403)}},success:function(e){e=JSON.parse(e);var a=t(i.target).parent();t(i.target).remove(),e.items.length>0?(e.items.map((function(t,i){var n=(t=encodeURI(t)).split(".");n.pop();n=n.join(".").split("/").pop(),void 0!==e.names&&""!==e.names[i]&&(n=e.names[i]),a.append('<li><img data-act="base" data-src="products/'+t+'" data-source="uploads" src="'+lumise_upload_url+"products/"+t+'" /><i class="fa fa-trash" title="'+lumise.i("delete")+'" data-act="delete" data-file="'+t+'"></i><span data-file="'+t+'" data-act="edit-name" data-name="'+encodeURIComponent(n)+'" title="'+lumise.i(171)+'">'+n+' <i data-file="'+t+'" data-act="edit-name" data-name="'+encodeURIComponent(n)+'" class="fa fa-pencil"></i></span></li>')})),e.items.length+e.start<e.total&&a.append('<li data-act="load-more" data-start="'+(e.items.length+e.start)+'">'+lumise.i(94)+" &rarr;</li>")):0===e.start&&a.append('<li data-view="noitems">'+lumise.i(169)+"</li>")}})}},new_stage:function(a){var i=t(this).closest("div.lumise_tabs_wrapper"),n=i.find(".lumise_tab_nav_wrap ul.lumise_tab_nav");if(n.find(">li").length>e.max_stages)return alert(lumise.i(163)),void a.preventDefault();var s=n.find('li[data-add="tab"]').prev().clone(!0),l=i.find("div.lumise_tabs div.lumise_tab_content").last().clone(!0),o=(new Date).getTime().toString(36);n.find('li[data-add="tab"]').before(s),s.find("a").attr({href:"#lumise-stage-"+o,"data-label":"Untitled"}).find("text").html("Untitled"),s.find(">a>span").remove(),l.attr({id:"lumise-stage-"+o,"data-stage":o}),i.find("div.lumise_tabs").append(l),i.find(".lumise_tab_content.active, ul.lumise_tab_nav li.active").removeClass("active"),l.find("div.lumise-stage-settings").attr({id:"lumise-product-design-"+o}),l.find("input.product-upload").attr({name:"product-upload-"+o}),l.find('.lumise-stage-btn button[data-btn="reset"]').click(),i.find('div.lumise_tab_nav_wrap>i[data-move="right"]').click(),setTimeout((function(t){t.click()}),10,s.find("a")),a.preventDefault()},upload_image_helper:function(t){if("function"==typeof this.cb&&this.files&&this.files[0]){var e=new FileReader;e.onload=this.cb,e.file=this.files[0],e.readAsDataURL(this.files[0])}this.type="text",this.value="",this.type="file",this.cb=null},is_stage_accord:function(e){var a=t(this),i=a.find("ul.lumise_tab_nav"),n=a.find("div.lumise_tab_nav_inner"),s=i.find("li.active");0!==i.width()&&i.width()>n.width()?(a.addClass("is_accord"),i.get(0).offsetLeft+i.width()<.5*n.width()&&i.css({left:n.width()-i.width()+"px"})):(a.removeClass("is_accord"),i.css({left:"0px"})),void 0===this.first_time&&s.get(0)&&s.get(0).offsetLeft>n.parent().width()&&i.css({left:-s.get(0).offsetLeft+(n.width()-s.width())+"px"}),this.first_time=!0},stage_accord:function(e){var a=this.getAttribute("data-move"),i=t(this.parentNode).find("div.lumise_tab_nav_inner"),n=i.find("ul.lumise_tab_nav"),s=i.width(),l=n.width(),o=parseFloat(n.css("left"));"left"==a&&o<0&&n.css({left:(o+.75*s<0?o+.75*s:0)+"px"}),"right"==a&&o>-(l-s)&&n.css({left:(o-.75*s>-(l-s)?o-.75*s:-(l-s))+"px"})}}),this.stage_events(),this.att_events()},stage_events:function(){trigger({el:t("#lumise-product-page"),events:{'button[data-func="select"]':"select_base",'button[data-func="download"]':"download_mockup",'button[data-func="reset"]':"reset_base",'select[data-name="sizes"]:change':"select_size",'input[data-name="width"]:change,input[data-name="height"]:change':"change_size",'input[data-name="width"]:keydown,input[data-name="height"]:keydown':function(t){13===t.keyCode&&this.blur()},'input[data-name="crop_marks_bleed"]:change':"crop_marks_bleed",".constrain-aspect-ratio":function(){t(this).hasClass("active")?t(this).removeClass("active"):t(this).addClass("active")},'i[data-func="resize"]':"input_size",".lumise-stage-editzone:mousedown":"start_drag",".lumise-stage-editzone:mouseup":function(){lumise.product.update_pos(t(this).closest("div.lumise-stage-design-view"))},".editzone-ranges .design-scale input:input":"design_scale",".editzone-ranges .editzone-radius input:input":"editradius",".lumise-stage-editzone button":"edit_funcs","#lumise_template":"template","#lumise_template_btn":"select_template","#lumise-stages-wrp ul.lumise_tab_nav li a":"edit_stage_label",'.lumise_form_content input[name="is_mask"]:change':"is_mask","#lumise-stages-wrp ul.lumise_tab_nav a:dragstart":function(t){t.preventDefault()}},select_base:function(e){!0!==t("#lumise-popup").attr("data-moved")&&t("body").append(t("#lumise-popup").attr({"data-moved":!0})),t("#lumise-popup").show().attr({"data-stage":t(this).closest("div.lumise_tab_content").attr("data-stage")}),t('#lumise-uploaded-bases li[data-act="load-more"][data-start="0"]').length>0&&t('#lumise-uploaded-bases li[data-act="load-more"]').click(),a("open"),e.preventDefault()},download_mockup:function(e){e.preventDefault();let a=document.createElement("canvas"),i=document.createElement("canvas"),n=t(this).closest(".lumise-stage-body"),s=n.find("img.lumise-stage-image").get(0),l=n.find("div.design-template-inner>img").get(0),o=n.find(".lumise-stage-editzone").get(0),d=a.getContext("2d"),r=i.getContext("2d"),u=s.width/s.naturalWidth;a.width=s.naturalWidth,a.height=s.naturalHeight,i.width=o.offsetWidth/u,i.height=o.offsetHeight/u,s.parentNode.style.backgroundColor?d.fillStyle=s.parentNode.style.backgroundColor:d.fillStyle="#ffffff",d.fillRect(0,0,a.width,a.height),l&&r.drawImage(l,l.offsetLeft/u,l.offsetTop/u,l.width/u,l.height/u);let c=parseFloat(o.style.marginTop.replace("px",""))/u,f=parseFloat(o.style.marginLeft.replace("px",""))/u;isNaN(c)&&(c=0),isNaN(f)&&(f=0),f+=o.offsetLeft/u,c+=o.offsetTop/u;let p=f,m=c,h=i.width,g=i.height,v=parseInt(o.style.borderRadius.replace("px",""));d.save(),d.beginPath(),d.moveTo(p+v,m),d.lineTo(p+h-v,m),d.quadraticCurveTo(p+h,m,p+h,m+v),d.lineTo(p+h,m+g-v),d.quadraticCurveTo(p+h,m+g,p+h-v,m+g),d.lineTo(p+v,m+g),d.quadraticCurveTo(p,m+g,p,m+g-v),d.lineTo(p,m+v),d.quadraticCurveTo(p,m,p+v,m),d.closePath(),d.clip(),d.drawImage(i,p,m,h,g),d.restore(),d.drawImage(s,0,0);let _=a.toDataURL("image/jpeg",1).split(",")??a.toDataURL("image/png",1).split(",")??a.toDataURL("image/svg",1).split(","),b=atob(_[1]),w=b.length,y=new Uint8Array(w);for(var x=0;x<w;x++)y[x]=b.charCodeAt(x);let k=new Blob([y],{type:_[0].substring(_[0].indexOf("image/"),_[0].indexOf(";")-1)}),j=document.createElement("a");j.download="lumise-mockup.jpg",j.href=URL.createObjectURL(k),j.click(),URL.revokeObjectURL(j.href)},reset_base:function(e){var a=t(this).closest(".lumise-stage-settings");a.find("img.lumise-stage-image").attr({src:"","data-url":""}),a.removeClass("stage-enabled").addClass("stage-disabled"),e.preventDefault()},select_size:function(e){var a=this.value,i=t(this).closest("div.lumise-stage-body"),n=i.find("div.lumise-stage-editzone"),s=i.find("img.lumise-stage-image");"custom"!=a&&""!==a?(n.css({height:n.width()/.7069555302166477+"px"}),n.height()>s.height()&&n.css({height:.9*s.height()+"px",width:.9*s.height()*.7069555302166477+"px"}),n.height()+n.get(0).offsetTop>.9*s.height()&&n.css({top:(s.height()-n.height())/2+"px"}),n.find('i[data-func="resize"]').attr({"data-info":n.width()+"x"+n.height()}),i.find('div.edr-row[data-row="values"], div.edr-row[data-row="unit"]').hide()):"custom"==a?(i.find('div.edr-row[data-row="values"], div.edr-row[data-row="unit"]').show(),""===e.data.el.find('input[data-name="width"]').val()&&""===e.data.el.find('input[data-name="height"]').val()?(e.data.el.find('input[data-name="width"]').val("21"),e.data.el.find('input[data-name="height"]').val("29.7")):""!==e.data.el.find('input[data-name="width"]').val()&&""===e.data.el.find('input[data-name="height"]').val()?e.data.el.find('input[data-name="height"]').val(parseFloat(e.data.el.find('input[data-name="width"]').val())*(29.7/21)):""===e.data.el.find('input[data-name="width"]').val()&&""!==e.data.el.find('input[data-name="height"]').val()&&e.data.el.find('input[data-name="width"]').val(parseFloat(e.data.el.find('input[data-name="width"]').val())*(21/29.7)),e.data.el.find('input[data-name="height"]').change()):i.find('div.edr-row[data-row="values"], div.edr-row[data-row="unit"]').hide(),lumise.product.update_pos(i)},change_size:function(e){var a=t(this).closest("div.lumise-stage-design-view"),i=a.find("img.lumise-stage-image"),n=a.find('input[data-name="width"]'),s=a.find('input[data-name="height"]'),l=a.find("div.lumise-stage-editzone"),o=0,d=0;""!==s.val()&&""!==n.val()&&("width"==this.getAttribute("data-name")?(o=l.height()*(parseFloat(n.val())/parseFloat(s.val())),d=l.height()):"height"==this.getAttribute("data-name")&&(d=l.width()*(parseFloat(s.val())/parseFloat(n.val())),o=l.width()),o>i.width()&&(d*=i.width()/o,o=i.width(),l.css({left:"0px"})),d>i.height()&&(o*=i.height()/d,d=i.height(),l.css({top:"0px"})),l.css({width:o+"px",height:d+"px"}),a.attr({"data-info":a.attr("data-info").split(":")[0]+": "+parseInt(o)+"x"+parseInt(d)}),l.get(0).offsetTop+l.height()>i.height()&&l.css({top:i.height()-l.get(0).offsetTop+"px"}),l.get(0).offsetLeft+l.width()>i.width()&&l.css({left:i.width()-l.get(0).offsetLeft+"px"})),lumise.product.update_pos(a)},crop_marks_bleed:function(e){let a=t(this).closest("div.lumise-stage-body");this.checked?a.find('div.edr-row[data-row="bleed-range"]').show():a.find('div.edr-row[data-row="bleed-range"]').hide()},edit_funcs:function(e){var a=this.getAttribute("data-func");if("select-design"==a)e.data.select_template(e);else if("clear-design"==a){var i=t("#lumise-stages-wrp .lumise_tab_content.active .lumise-stage-editzone");i.length>0&&confirm(lumise.i(101))&&i.find(".design-template-inner").remove(),this.style.display="none",i.append('<button data-func="select-design" class="design-template-btn">\t\t\t\t\t\t\t\t<i class="fa fa-paint-brush"></i> \t\t\t\t\t\t\t\t'+lumise.i(91)+"\t\t\t\t\t\t\t\t</button>"),i.find("button").on("click",e.data.select_template),t(".lumise_field_stages .lumise_tab_content.active .editzone-ranges .design-scale").hide()}return e.preventDefault(),!1},design_scale:function(e){var a=t(this).closest(".lumise-stage-design-view").find(".design-template-inner img");if(0===a.length)return;var i=a.get(0),n=parseFloat(this.value),s=i.naturalWidth,l=i.naturalHeight,o=parseFloat(i.style.width.replace("px","")),d=parseFloat(i.style.height.replace("px","")),r=parseFloat(i.style.left.replace("px","")),u=parseFloat(i.style.top.replace("px",""));n&&!isNaN(n)||(n=1),isNaN(o)&&(o=i.offsetWidth),isNaN(d)&&(d=i.offsetHeight),isNaN(u)&&(u=i.offsetTop),isNaN(r)&&(r=i.offsetLeft);let c=s*n/100,f=l*n/100,p=(c-o)/2,m=(f-d)/2;a.css({width:c+"px",height:f+"px",left:r-p+"px",top:u-m+"px"}),lumise.product.update_pos(t(this).closest("div.lumise-stage-design-view"))},editradius:function(e){t(this).closest(".lumise-stage-design-view").find(".lumise-stage-editzone,.design-template-inner").css({borderRadius:this.value+"%"})},start_drag:function(e){if(t(e.target).closest(".design-template-inner").length>0)var a=t(e.target).closest(".design-template-inner").find("img"),i=e.clientX,n=e.clientY,s=a.get(0).offsetLeft,l=a.get(0).offsetTop,o=a.get(0).offsetWidth,d=a.get(0).offsetHeight,r=!1,u=!1;else{var c=e.target.getAttribute("data-func")||e.target.parentNode.getAttribute("data-func"),f=t(e.target).hasClass(".editzone-gui")||t(e.target).closest(".editzone-gui").length>0;if("move"!=c&&"resize"!=c&&!0!==f)return!1;a=t(this),i=e.clientX,n=e.clientY,s=this.offsetLeft,l=this.offsetTop,o=this.offsetWidth,d=this.offsetHeight,r=!0;var p=t(e.target),m=p.closest(".lumise-stage-design-view"),h=m.find('select[data-name="sizes"]').val(),g=m.find("span.constrain-aspect-ratio").hasClass("active"),v=m.find('input[data-name="width"]'),_=m.find('input[data-name="height"]'),b=parseFloat(v.val())/parseFloat(_.val()),w=""!==h&&"custom"!=h;u="resize"==e.target.getAttribute("data-func")||"resize"==e.target.parentNode.getAttribute("data-func");w&&(b=.70715)}t(document).on("mousemove",(function(t){var e=a.parent().width();if(ph=a.parent().height()-a.parent().find(".editzone-ranges").height(),u){var c=o+2*(t.clientX-i),f=d+2*(t.clientY-n);c<30&&(c=30),f<50&&(f=50),c>e-a.get(0).offsetLeft&&(c=e-a.get(0).offsetLeft),f>ph-a.get(0).offsetTop&&(f=ph-a.get(0).offsetTop),s-(c-o)/2<0&&(s=(c-o)/2),l-(f-d)/2<0&&(l=(f-d)/2),(w||"custom"==h&&!0===g)&&(c/b>f?(f=c/b)>ph-l&&(c=(f=ph-l)*b):(c=f*b)>e-s&&(f=(c=e-s)/b),s-(c-o)/2<0&&(f=(c=o+2*s)/b),l-(f-d)/2<0&&(c=(f=d+2*l)*b)),c=Math.ceil(c),f=Math.ceil(f),a.css({width:c+"px",height:f+"px",left:s-(c-o)/2+"px",top:l-(f-d)/2+"px"}).attr({"data-pos":"{width: "+c+", height: "+f+", top: "+(a.get(0).offsetTop-a.parent().height()/2+a.height()/2)+", left: "+(a.get(0).offsetLeft-a.parent().width()/2+a.width()/2)+"}"}),m.attr({"data-info":m.attr("data-info").split(":")[0]+": "+c+"x"+f}),"custom"!=h||g&&""!==v.val()&&""!==_.val()||(""!==v.val()?_.val((parseFloat(v.val())*(f/c)).toFixed(5)):""!==_.val()&&v.val((parseFloat(_.val())*(c/f)).toFixed(5)))}else{var p=s+(t.clientX-i),y=l+(t.clientY-n);r?(p<0&&(p=0),y<0&&(y=0),p>e-o&&(p=e-o),y>ph-d&&(y=ph-d)):(p<.85*-o&&(p=.85*-o),y<.85*-d&&(y=.85*-d),p>e-.15*o&&(p=e-.15*o),y>ph-.15*d&&(y=ph-.15*d)),Math.abs(p+o/2-e/2)<=2&&(p=Math.ceil(e/2-o/2)),Math.abs(y+d/2-ph/2)<=2&&(y=Math.ceil(ph/2-d/2)),a.css({left:p+"px",top:y+"px"})}})).on("mouseup",(function(e){t(document).off("mousemove mouseup"),u&&(a.get(0).offsetLeft<0&&a.css({left:"0px"}),a.get(0).offsetTop<0&&a.css({top:"0px"}))})),u&&p.off("mouseup").on("mouseup",(function(e){if(e.originalEvent.offsetX>this.offsetHeight&&Math.abs(i-e.clientX)<=3&&Math.abs(n-e.clientY)<=3){var a=prompt(lumise.i(167),this.getAttribute("data-info")),s=this.getAttribute("data-info").split("x");if(null!==a&&a.indexOf("x")>-1){a=a.split("x");var l=t(this).closest("div.lumise-stage-design-view").find("img.lumise-stage-image"),o=t(this).closest("div.lumise-stage-editzone");parseFloat(a[0])>l.width()&&(a[0]=l.width(),o.css({left:0})),parseFloat(a[1])>l.height()&&(a[1]=l.height(),o.css({top:0})),w&&(a[0]!=s[0]?a[1]=a[0]/.70715:a[0]=.70715*a[1],parseFloat(a[0])>l.width()&&(a[0]=l.width(),a[1]=a[0]/.70715,o.css({left:0})),parseFloat(a[1])>l.height()&&(a[1]=l.height(),a[0]=.70715*a[1],o.css({top:0}))),this.setAttribute("data-info",Math.ceil(a[0])+"x"+Math.ceil(a[1])),o.css({width:a[0]+"px",height:a[1]+"px"})}}}))},template:function(e){"I"==e.target.tagName&&"#delete"==e.target.parentNode.getAttribute("href")?(this.innerHTML="",t("#lumise_template_inp").val("")):e.data.select_template(e),e.preventDefault()},select_template:function(t){lumise.product.load_designs({}),t.preventDefault()},edit_stage_label:function(e){if(this.parentNode.className.indexOf("active")>-1&&"delete-thumbn"==e.target.getAttribute("data-func"))return t(this).find("span").remove(),void e.preventDefault();if(this.parentNode.className.indexOf("active")>-1&&("thumbnail"==e.target.getAttribute("data-edit")||"upload-thumbn"==e.target.getAttribute("data-func"))){var a="upload-thumbn"==e.target.getAttribute("data-func")?t(e.target).closest("li").find("a>i"):t(e.target);return lumise.product.upload({max_height:160,callback:function(t){a.prevAll("span").remove(),a.before('<span>\t\t\t\t\t\t\t\t\t\t\t<img src="'+t+'" data-func="upload-thumbn" />\t\t\t\t\t\t\t\t\t\t\t<i data-func="delete-thumbn" class="fa fa-times"></i>\t\t\t\t\t\t\t\t\t    </span>')}}),void e.preventDefault()}if(this.parentNode.className.indexOf("active")>-1&&"TEXT"==e.target.tagName){var i=prompt(LumiseDesign.js_lang[151],decodeURIComponent(e.target.parentNode.getAttribute("data-label")).replace(/\&gt\;/,">").replace(/\&lt\;/,"<").replace(/\&Prime\;/,'"').replace(/\&prime\;/,"'"));if(null===i||""===i)return;if(""===(i=i.replace(/\>/g,"&gt;").replace(/\</g,"&lt;").replace(/\"/g,"&Prime;").replace(/\'/g,"&prime;")))return;t(e.target).parent().attr({"data-label":encodeURIComponent(i)}),t(this).parent().find("text").html(i)}},is_mask:function(e){let a=t(this).closest("div.lumise-stages-wrp").find("div.lumise-stage-body").attr({"data-is-mask":this.checked}).find('input[name="is_mask"]');this.checked?a.attr({checked:"checked"}):a.removeAttr("checked")}},!0),t(".lumise-stages-wrp ul.lumise_tab_nav").sortable({items:'>li:not([data-add="tab"])',tolerance:"pointer"}),t(".lumise-stages-wrp .lumise_tab_nav_wrap").click()},att_events:function(){trigger({init:function(t){t.data.add_attribute_events(t),t.data.add_variation_events(t),t.data.load_attributes(t),t.data.load_variations(t)},el:t("#lumise-product-form"),events:{":click":function(t){var e=t.target.getAttribute("data-act");null!==e&&"function"==typeof t.data.global_actions[e]&&t.data.global_actions[e](t)},'[data-act="add_attribute"]':"add_attribute",'[data-act="add_variation"]':"add_variation",'[data-act="bulk_edit_variation"]':"bulk_edit_variation",'[data-act="expand"]':"expand",'[data-act="close"]':"close"},global_actions:{delete:function(e){confirm("Are you sure?")&&(t(e.target).closest(".lumise-att-layout-item").remove(),e.data.refresh_variations(e))},toggle:function(e){t(e.target).closest(".lumise-att-layout-item").find(".att-layout-body").slideToggle(250,(function(){"none"==this.style.display?t(this).closest(".lumise-att-layout-item").find('.att-layout-headitem i[data-act="toggle"]').removeClass("fa-caret-up").addClass("fa-caret-down"):t(this).closest(".lumise-att-layout-item").find('.att-layout-headitem i[data-act="toggle"]').removeClass("fa-caret-down").addClass("fa-caret-up")}))}},add_attribute_events:function(e){var a=e.data;t('#lumise-product-form .lumise-att-layout-item:not([data-event="added"])').each((function(){this.setAttribute("data-event","added"),trigger({el:t(this),events:{'input[data-name="name"]:input':"name",'input[data-name="name"]:change, textarea[data-name="values"]:change':a.refresh_variations,'input[data-name="use_variation"]:change':"use_variation",'select[data-name="type"]:change':"type"},name:function(e){t(this).closest(".lumise-att-layout-item").find(".att-layout-headitem strong[data-name]").html(this.value)},use_variation:function(e){var i=t(this).closest(".att-layout-body-field").find('[data-name="type"]'),n=i.find("option"),s=[];n.each((function(){"true"==this.getAttribute("data-use-variation")&&s.push(this.value)})),!0===this.checked?n.each((function(){-1===s.indexOf(this.value)&&(this.disabled=!0),-1===s.indexOf(i.val())&&this.value==(s.length>0?s[0]:"")&&(this.selected=!0,i.trigger("change"))})):n.each((function(){this.disabled=null})),a.refresh_variations(e)},type:function(e){if("true"==t(this).find("option:selected").attr("data-unique")){var i=!1,n=this,s=t(this).val();if(t(this).closest("#lumise-field-attributes-items").find('select[data-name="type"]').each((function(){this!==n&&this.value==s&&(i=!0)})),!0===i)return alert(document.lumiseconfig.noc),t(this).val(""),!1}t(this).closest(".lumise-att-layout-item").find('.att-layout-headitem em[data-view="attr-type"]').html(this.options[this.selectedIndex].text),lumise.product.render_values(t(this).closest("div.lumise-att-layout-item").find('div[data-field="values"]'),this.value),e.data.el.find('textarea[data-name="values"]').on("change",a.refresh_variations)}})})),t("#lumise-product-form .lumise-field-layout-items").sortable({handle:'a[data-act="arrange"]',update:function(t){a.refresh_variations(t)}})},add_variation_events:function(e){t('#lumise-product-form .lumise-att-layout-item:not([data-event="added"])').each((function(){this.setAttribute("data-event","added"),this.edata=e.data,trigger({el:t(this),events:{"input[data-cfgstages]:change":"cfgstages","input[data-cfgprinting]:change":"cfgprinting"},cfgstages:function(e){var a=t(this).closest(".att-layout-body-field").find(".att-layout-cfgstages");!0!==this.checked?a.slideToggle(250,(function(){t(this).html("").hide()})):lumise.product.clone_stages(a)},cfgprinting:function(e){var a=t(this).closest(".att-layout-body-field").find(".att-layout-cfgprinting");!0!==this.checked?a.slideToggle(250,(function(){t(this).html("").hide()})):lumise.product.clone_printing(a)}})})),t("#lumise-product-form .lumise-field-layout-items").sortable({handle:'a[data-act="arrange"]'})},bulk_edit_variation:function(e){var a=lumise.product.get_attributes(!0),n="";Object.keys(a).length>0&&Object.keys(a).map((function(t){var e='<option value="">Any '+esc_html(a[t].name)+"</option>";if(void 0!==a[t].values&&""!==a[t].values){if("string"==typeof a[t].values)try{a[t].values=JSON.parse(a[t].values)}catch(e){a[t].values=[]}"object"==typeof a[t].values&&"object"==typeof a[t].values.options&&a[t].values.options.map((function(t){e+='<option value="'+esc_html(t.value)+'">'+esc_html(void 0!==t.title?t.title.trim():t.value)+"</option>"}))}n+='<select data-name="'+t+'">'+e+"</select>"})),i({width:750,content:'<div class="lumise-bulk-form">\t\t\t\t\t\t\t\t\t<h3>'+LumiseDesign.js_lang[203]+'</h3>\t\t\t\t\t\t\t\t\t<p class="lumise-update-notice success hidden" style="width: 100%;"></p>\t\t\t\t\t\t\t\t\t<p data-view="conditions">\t\t\t\t\t\t\t\t\t\t<label>'+LumiseDesign.js_lang[200]+":</label>\t\t\t\t\t\t\t\t\t\t"+n+"\t\t\t\t\t\t\t\t\t</p>\t\t\t\t\t\t\t\t\t<p>\t\t\t\t\t\t\t\t\t\t<label>"+LumiseDesign.js_lang[201]+':</label>\t\t\t\t\t\t\t\t\t\t<select name="apply-for">\t\t\t\t\t\t\t\t\t\t\t<option value="price">'+LumiseDesign.js_lang[104]+'</option>\t\t\t\t\t\t\t\t\t\t\t<option value="min-qty">'+LumiseDesign.js_lang[205]+'</option>\t\t\t\t\t\t\t\t\t\t\t<option value="max-qty">'+LumiseDesign.js_lang[206]+'</option>\t\t\t\t\t\t\t\t\t\t\t<option value="description">'+LumiseDesign.js_lang[207]+"</option>\t\t\t\t\t\t\t\t\t\t</select>\t\t\t\t\t\t\t\t\t</p>\t\t\t\t\t\t\t\t\t<p>\t\t\t\t\t\t\t\t\t\t<label>"+LumiseDesign.js_lang[202]+':</label>\t\t\t\t\t\t\t\t\t\t<textarea name="new-value" style="width: 550px;height: 120px;"></textarea>\t\t\t\t\t\t\t\t\t</p>\t\t\t\t\t\t\t\t\t<hr>\t\t\t\t\t\t\t\t\t<p><center><button class="apply lumise-button lumise-button-primary lumise-button-large">'+LumiseDesign.js_lang.apply+'</button> &nbsp; <button class="cancel lumise-button lumise-button-large">'+LumiseDesign.js_lang.cancel+"</button></center></p>\t\t\t\t\t\t\t\t</div>"}),trigger({el:t("#lumise-lightbox"),events:{"button.apply":"apply","button.cancel":"cancel","select:focus,textarea:focus":"remove_notice"},apply:function(e){var a={},i=e.data.el.find('select[name="apply-for"]').val(),n=e.data.el.find('textarea[name="new-value"]').val(),s=0;e.data.el.find('p[data-view="conditions"] select').each((function(){a[this.getAttribute("data-name")]=t(this).val()})),t("#lumise-field-variations-items>div.lumise-att-layout-item").each((function(){var e=!0;t(this).find(".att-layout-conditions select[data-name]").each((function(){var i=this.getAttribute("data-name");!0===e&&(void 0===a[i]||""!==a[i]&&a[i]!=t(this).val())&&(e=!1)})),!0===e&&(s++,t(this).find('[data-name="'+i+'"]').val(n).trigger("change"))})),e.data.el.find(".lumise-update-notice").removeClass("hidden").html(LumiseDesign.js_lang[204].replace("%s",s))},cancel:function(e){t("#lumise-lightbox").remove(),e.preventDefault()},remove_notice:function(t){t.data.el.find(".lumise-update-notice").addClass("hidden")}}),e.preventDefault()},add_att:function(e){var a=t(e).closest(".lumise-att-layout"),i=a.find("div.lumise-att-layout-tmpl>div.lumise-att-layout-item").clone(),n=a.find(".lumise-field-layout-items"),s=(new Date).getTime().toString(36).substr(4).toUpperCase();return a.find(".lumise-att-layout-item>.att-layout-body").hide().closest(".lumise-att-layout-item").find('.att-layout-headitem i[data-act="toggle"]').removeClass("fa-caret-up").addClass("fa-caret-down"),n.append(i),i.attr({"data-id":s}).removeAttr("data-event").find("div.att-layout-body").show().find("input").first().focus().closest(".lumise-att-layout-item").find('.att-layout-headitem i[data-act="toggle"]').removeClass("fa-caret-down").addClass("fa-caret-up"),i},add_attribute:function(e){var a=e.data.add_att(t(e.target).closest(".lumise-att-layout")),i=a.attr("data-id");a.find('[data-field="use_variation"] label').attr({for:"use-var-"+i}),a.find('[data-field="use_variation"] input').attr({id:"use-var-"+i}),a.find('[data-field="required"] label').attr({for:"required-"+i}),a.find('[data-field="required"] input').attr({id:"required-"+i}),lumise.product.render_values(a.find('div[data-field="values"]'),"input"),e.data.add_attribute_events(e),e.preventDefault()},add_variation:function(e){var a=e.data.add_att(t(e.target).closest(".lumise-att-layout")),i=a.attr("data-id");a.find(".att-layout-conditions>strong").html("#"+i),a.find(".att-layout-conditions").append(t(e.target).closest(".lumise-att-layout").find(".lumise-att-layout-default .att-layout-conditions select").clone()),a.find(".att-layout-conditions select").each((function(){t(this).find("option").first().prop({selected:!0})})),a.find('input[data-cfgstages="no"]').attr({id:"custom-config-no-"+i,name:"cfgstages-"+i}).prop({checked:!0}),a.find('label[data-cfgstages="no"]').attr({for:"custom-config-no-"+i}),a.find('input[data-cfgstages="yes"]').attr({id:"custom-config-yes-"+i,name:"cfgstages-"+i}),a.find('label[data-cfgstages="yes"]').attr({for:"custom-config-yes-"+i}),t(e.target).closest(".lumise-att-layout").find(".lumise-att-layout-default").removeClass("hidden"),e.data.add_variation_events(e),e.data.refresh_variations(e),e.preventDefault()},expand:function(e){e.preventDefault(),t(e.target).closest(".lumise-att-layout").find(".att-layout-body").show().closest(".lumise-att-layout-item").find('.att-layout-headitem i[data-act="toggle"]').removeClass("fa-caret-down").addClass("fa-caret-up")},close:function(e){e.preventDefault(),t(e.target).closest(".lumise-att-layout").find(".att-layout-body").hide().closest(".lumise-att-layout-item").find('.att-layout-headitem i[data-act="toggle"]').removeClass("fa-caret-up").addClass("fa-caret-down")},load_attributes:function(e){var a=e.data,i=t("#lumise-tab-attributes .lumise-att-layout"),n=t("#lumise-field-attributes-inp").val();void 0!==n&&""!==n&&(n=dejson(n.trim()),Object.keys(n).map((function(t){var s=e.data.add_att(i),l=n[t];lumise.product.render_values(s.find('div[data-field="values"]'),""!=l.type?l.type:"input",l.values),/^\d+$/.test(t)&&(t=(new Date).getTime().toString(36).substr(4).toUpperCase()),s.attr({"data-id":t}),s.find('[data-field="use_variation"] label').attr({for:"use-var-"+t}),s.find('[data-field="use_variation"] input').attr({id:"use-var-"+t}),s.find('[data-field="required"] label').attr({for:"required-"+t}),s.find('[data-field="required"] input').attr({id:"required-"+t}),s.find(".att-layout-headitem strong[data-name]").html(l.name),s.find('input[data-name="name"]').val(l.name),s.find('select[data-name="type"]').val(l.type),s.find('.att-layout-headitem em[data-view="attr-type"]').html(s.find('select[data-name="type"] option:selected').text()),s.find('input[data-name="use_variation"]').prop({checked:l.use_variation}),s.find('input[data-name="required"]').prop({checked:l.required}),s.find('textarea[data-name="values"]').val("object"==typeof l.values?JSON.stringify(l.values):l.values),a.add_attribute_events(e),l.use_variation&&s.find('input[data-name="use_variation"]').change()})))},load_variations:function(e){var a=e.data,i=t("#lumise-tab-variations .lumise-att-layout"),n=t("#lumise-field-variations-inp").val();void 0!==n&&""!==n&&(n=dejson(n.trim()),Object.keys(n.variations).map((function(t){var s=e.data.add_att(i),l=n.variations[t];s.attr({"data-id":t}).find(".att-layout-conditions>strong").html("#"+t),s.find('input[data-cfgstages="no"]').attr({id:"custom-config-no-"+t,name:"cfgstages-"+t}),s.find('label[data-cfgstages="no"]').attr({for:"custom-config-no-"+t}),s.find('input[data-cfgstages="yes"]').attr({id:"custom-config-yes-"+t,name:"cfgstages-"+t}),s.find('label[data-cfgstages="yes"]').attr({for:"custom-config-yes-"+t}),s.find('input[data-name="price"]').val(l.price),s.find('input[data-name="min-qty"]').val(l.minqty),s.find('input[data-name="max-qty"]').val(l.maxqty),s.find('textarea[data-name="description"]').val(l.description),s.find('input[data-name="cfgstages"]').prop({checked:l.cfgstages}),s.find('input[data-name="cfgprinting"]').prop({checked:l.cfgprinting}),Object.keys(l.conditions).map((function(t){s.find(".att-layout-conditions").append('<select data-name="'+t+'">\t\t\t\t\t\t\t\t\t\t<option selected value="'+l.conditions[t]+'"></option>\t\t\t\t\t\t\t\t\t</select>')})),null!==l.stages&&"object"==typeof l.stages&&lumise.product.clone_stages(s.find(".att-layout-cfgstages"),l.stages),null!==l.printings&&"object"==typeof l.printings&&lumise.product.clone_printing(s.find(".att-layout-cfgprinting"),l.printings),a.add_variation_events(e)})),Object.keys(n.default).map((function(t){i.find(".lumise-att-layout-default .att-layout-conditions").append('<select data-name="'+t+'"><option selected value="'+n.default[t]+'"></option></select>')})),delete window.old_refresh_variations,a.refresh_variations(e))},refresh_variations:function(e){var a=lumise.product.get_attributes(!0);if(void 0===window.old_refresh_variations||window.old_refresh_variations!=JSON.stringify(a)){window.old_refresh_variations=JSON.stringify(a);var i=t("#lumise-variations"),n=i.find(".lumise-field-layout-items>.lumise-att-layout-item"),s={};i.find(".lumise-att-layout-default select").each((function(){s[this.getAttribute("data-name")]=this.value})),i.find(".lumise-att-layout-default select").remove(),0===Object.keys(a).length?(n.remove(),i.find(".lumise-att-layout-default").addClass("hidden"),i.find('[data-act="add_variation"], a[data-act], [data-act="bulk_edit_variation"]').hide(),i.find('p[data-view="notice"]').show()):(i.find('[data-act="add_variation"], a[data-act], [data-act="bulk_edit_variation"]').show(),i.find('p[data-view="notice"]').hide(),Object.keys(a).map((function(t){var e='<option value="">Any '+esc_html(a[t].name)+"</option>";if(void 0!==a[t].values&&""!==a[t].values){if("string"==typeof a[t].values)try{a[t].values=JSON.parse(a[t].values)}catch(e){a[t].values=[]}"object"==typeof a[t].values&&"object"==typeof a[t].values.options&&a[t].values.options.map((function(a){e+="<option "+(void 0!==s[t]&&s[t]==a.value?"selected":"")+' value="'+esc_html(a.value)+'">'+esc_html(void 0!==a.title?a.title.trim():a.value)+"</option>"}))}i.find(".lumise-att-layout-default .att-layout-conditions").append('<select data-name="'+t+'">'+e+"</select>")})),n.length>0?i.find(".lumise-att-layout-default").removeClass("hidden"):i.find(".lumise-att-layout-default").addClass("hidden"),n.each((function(){var e={},i=t(this);i.find(".att-layout-conditions select").each((function(){e[this.getAttribute("data-name")]=this.value})),i.find(".att-layout-conditions select").remove(),Object.keys(a).map((function(t){var n='<option value="">Any '+esc_html(a[t].name)+"</option>";if(void 0!==a[t].values&&""!==a[t].values){if("string"==typeof a[t].values)try{a[t].values=JSON.parse(a[t].values)}catch(e){a[t].values={options:[]}}"object"==typeof a[t].values&&"object"==typeof a[t].values.options&&a[t].values.options.map((function(a){n+="<option "+(void 0!==e[t]&&e[t]==a.value?"selected":"")+' value="'+esc_html(a.value)+'">'+esc_html(void 0!==a.title?a.title.trim():a.value)+"</option>"}))}i.find(".att-layout-conditions").append('<select data-name="'+t+'">'+n+"</select>")}))})))}}},"varattr")},render_designs:function(e){var i=['<ul data-view="categories">',"<h3>"+lumise.i(90)+"</h3>",'<li data-id="" '+(""===e.category?'class="active"':"")+' data-lv="0"> '+lumise.i(57)+"</li>"],n=['<h3 data-view="top">'+lumise.i(91)+'<input id="search-templates-inp" type="search" placeholder="'+lumise.i(92)+'" value="'+encodeURIComponent(e.q)+'" /></h3>','<ul data-view="items">'];if(e.categories_full&&e.categories_full.map((function(t){i.push('<li data-id="'+t.id+'" '+(t.id==e.category?'class="active"':"")+' data-lv="'+(t.lv?t.lv:0)+'">'+"&mdash;".repeat(t.lv)+" "+t.name+"</li>")})),e.items&&e.items.length>0){var s=t("#lumise_template").val();window.ops_designs=e.items,e.items.map((function(t){n.push('<li data-id="'+t.id+'"'+(s==t.id?' data-current="true"':"")+'>\t\t\t\t\t\t\t\t<span data-view="thumbn" data-start="'+lumise.i(93)+'">\t\t\t\t\t\t\t\t\t<img src="'+t.screenshot+'" />\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t<span data-view="name">'+t.name+"</span>\t\t\t\t\t\t\t</li>")})),e.index+e.limit<e.total&&n.push('<li data-loadmore="'+(e.index+e.limit)+'">\t\t\t\t\t\t\t\t<span>'+lumise.i(94)+"</span>\t\t\t\t\t\t\t</li>")}else n.push('<li data-view="noitem" data-category="'+e.category+'">'+lumise.i(42)+"</li>");0==e.index?(i.push("</ul>"),n.push("</ul>"),t("#lumise-lightbox-content").html('<div id="lumise-list-items-wrp"></div>'),t("#lumise-list-items-wrp").html(i.join("")).append(n.join(""))):(t('#lumise-lightbox-content ul[data-view="items"] li[data-loadmore]').remove(),n[0]="",n[1]="",t('#lumise-lightbox-content ul[data-view="items"]').append(n.join(""))),trigger({el:t("#lumise-list-items-wrp"),events:{'ul[data-view="categories"] li':"category",'ul[data-view="items"] li':"design",'h3[data-view="top"] input:keyup':"search","li[data-loadmore]":"load_more"},category:function(e){lumise.product.load_designs({category:this.getAttribute("data-id"),index:0,q:t("#search-templates-inp").val()}),e.preventDefault()},design:function(e){if(null!==this.getAttribute("data-loadmore"))return e.data.load_more(e);var i=this.getAttribute("data-id"),n=ops_designs.filter((function(t){return t.id==i}));t(this).closest("#lumise-lightbox").remove(),a("close"),t("body.LumiseDesign").width()>1e3&&t("body").css({overflow:""}),lumise.product.render_design(n[0])},load_more:function(e){this.innerHTML='<i class="lumise-spinner x3"></i>',this.style.background="transparent",t(this).off("click"),lumise.product.load_designs({category:this.getAttribute("data-category"),index:this.getAttribute("data-loadmore"),q:t("#search-templates-inp").val()})},search:function(t){void 0!==t.keyCode&&13===t.keyCode&&lumise.product.load_designs({q:this.value})}})},render_design:function(e){var a=t("#lumise-stages-wrp .lumise_tab_content.active .lumise-stage-editzone");if(0!==a.length){var i=new Image;i.src=e.screenshot,a.find(".design-template-inner,.design-template-btn").remove(),a.append('<div class="design-template-inner" style="border-radius:'+a.css("border-radius")+'" data-id="'+e.id+'"></div>'),a.find('button[data-func="clear-design"]').css({display:""}),a.find(".design-template-inner").append(i),i.onload=function(){this.width>this.parentNode.offsetWidth&&(this.width=this.parentNode.offsetWidth,this.height=this.parentNode.offsetWidth*(this.naturalHeight/this.naturalWidth)),this.style.left=this.parentNode.offsetWidth/2-this.width/2+"px",this.style.top=this.parentNode.offsetHeight/2-this.height/2+"px";var e=t(this).closest(".lumise-stage-design-view").find(".editzone-ranges .design-scale");e.show(),e.find("input").val(this.width/this.naturalWidth*100).trigger("input"),lumise.product.update_pos(t(this).closest("div.lumise-stage-design-view"))}}},load_designs:function(e){void 0!==e.index&&0!==e.index||i({content:'<center><i class="lumise-spinner x3"></i></center>'}),t.ajax({url:window.parent&&window.parent.lumisejs&&!1===window.parent.lumisejs.is_admin?window.parent.lumisejs.admin_ajax_url:LumiseDesign.ajax,method:"POST",data:{nonce:window.parent&&window.parent.lumisejs&&!1===window.parent.lumisejs.is_admin?"LUMISE-SECURITY-BACKEND:"+window.parent.lumisejs.nonce_backend:"LUMISE_ADMIN:"+LumiseDesign.nonce,ajax:"backend",action:"templates",category:void 0!==e.category?e.category:"",q:void 0!==e.q?e.q:"",index:void 0!==e.index?e.index:0},statusCode:{403:function(){alert(LumiseDesign.js_lang.error_403)}},success:lumise.product.render_designs})},set_image:function(e,i){var n=t("#lumise-popup").hide().attr("data-stage"),s=t("#lumise-product-design-"+n);a("close"),e.indexOf("image/svg+xml")>-1||"svg"==e.split(".").pop()?s.find("img.lumise-stage-image").attr({"data-svg":"1"}):s.find("img.lumise-stage-image").attr({"data-svg":""});var l=e;"raws"==i?l=lumise_assets_url+"assets/raws/"+e:-1===e.indexOf("data:image/")&&(l=e.match(/^(?:http|https):\/\//gm)?e:lumise_upload_url+e),"jpg"!=l.split(".").pop()&&0!==l.indexOf("data:image/jpeg")||s.find('input[name="is_mask"]').prop({checked:!1}),s.find("img.lumise-stage-image").attr({src:l,"data-url":e,"data-source":i}).off("load").on("load",(function(){var e=s.find("div.lumise-stage-editzone"),a=s.find(".lumise-stage-image");e.css({left:"",top:"",height:"",width:""}),s.addClass("stage-enabled").removeClass("stage-disabled"),a.height()<=280&&(e.css({top:"10px",height:s.find(".lumise-stage-image").height()-20+"px"}),e.css({width:e.width()+"px",left:e.get(0).offsetLeft+"px"})),a.width()<=175&&(e.css({left:"10px",width:a.width()-20+"px"}),e.css({height:e.height()+"px",top:e.get(0).offsetTop+"px"})),""!==s.find('input[name="old-product-upload-'+n+'"]').val()&&s.find('button[data-btn="revert"]').show(),t("html,body").scrollTop(t("#lumise-stages-wrp").offset().top+30)}))},upload_images_submit:function(e,a){var i={},n=new FormData;return id="","object"==typeof e&&Object.keys(e).map((function(t){e[t].url.indexOf("data:image/")>-1&&"uploads"==e[t].source&&(id=(new Date).getTime().toString(36),i[id]={type:"stages",stage:t},n.append(id,new Blob([e[t].url])))})),"object"==typeof a&&"object"==typeof a.variations&&Object.keys(a.variations).map((function(t){a.variations[t].cfgstages&&"object"==typeof a.variations[t].stages&&Object.keys(a.variations[t].stages).map((function(e){a.variations[t].stages[e].url.indexOf("data:image/")>-1&&"uploads"==a.variations[t].stages[e].source&&(id=(new Date).getTime().toString(36),i[id]={type:"variations",variation:t,stage:e},n.append(id,new Blob([a.variations[t].stages[e].url])))}))})),0===Object.keys(i).length||(n.append("action","upload_product_images"),n.append("nonce","LUMISE_ADMIN:"+LumiseDesign.nonce),t('#lumise-product-form input[type="submit"]').hide().after('<button disabled="true" class="lumise-btn" id="lumise-product-form-submitting"><i class="fa fa-spin fa-spinner"></i> Uploading..</button>'),t.ajax({data:n,type:"POST",url:LumiseDesign.ajax,contentType:!1,processData:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var a=e.loaded/e.total;a<1?t("#lumise-product-form-submitting").html('<i class="fa fa-spin fa-spinner"></i> '+parseInt(100*a)+"% upload complete"):t("#lumise-product-form-submitting").html("Submiting..")}}),!1),e},success:function(n,s){0!==n.indexOf("Error")?(n=JSON.parse(n),Object.keys(n).map((function(t){void 0!==i[t]&&("stages"==i[t].type?e[i[t].stage].url=n[t]:"variations"==i[t].type&&(a.variations[i[t].variation].stages[i[t].stage].url=n[t]))})),t("textarea#lumise-field-stages-inp").val(enjson(e)),t("textarea#lumise-field-variations-inp").val(enjson(a)),t("#lumise-product-form").off("submit").submit()):alert(n)},error:function(){alert("Error: could not upload images this time, please try again later")}}),!1)},upload:function(e){t("#lumise-stages-upload-helper").get(0).cb=function(t){if(0===this.file.type.indexOf("image/")||this.file.name.indexOf(".jpg")==this.file.name.length-4||this.file.name.indexOf(".jpeg")==this.file.name.length-5||this.file.name.indexOf(".png")==this.file.name.length-4||this.file.name.indexOf(".svg")==this.file.name.length-4)if(void 0===e.type||-1!==e.type.value.indexOf(this.file.type))if(void 0!==e.min_size&&this.file.size<e.min_size.value)alert(e.min_size.err_msg+Math.round(this.file.size/1024)+"KB");else if(void 0!==e.max_size&&this.file.size>e.max_size.value)alert(e.max_size.err_msg+Math.round(this.file.size/1024)+"KB");else{if(0===t.target.result.indexOf("data:image/svg+xml"))return e.callback(lumise.svguni(t.target.result));var a=new Image;a.onload=function(){if("object"!=typeof e.fit&&void 0===e.height&&void 0===e.width&&(void 0===e.max_height||e.max_height>=this.height)&&(void 0===e.max_width||e.max_width>=this.width))return e.callback(t.target.result);var i=document.createElement("canvas"),n=void 0!==e.width?e.width:void 0===e.max_width||this.width<e.max_width?this.width:e.max_width,s=n*(this.height/this.width),l=0,o=0;(void 0!==e.max_width&&n>e.max_width&&(s=(n=e.max_width)*(this.height/this.width)),void 0!==e.max_height&&s>e.max_height&&(n=e.max_height*(n/s),s=e.max_height),void 0!==e.min_width&&n<e.min_width&&(s=e.min_width*(s/n),n=e.min_width),void 0!==e.min_height&&s<e.min_height&&(n=e.min_height*(n/s),s=e.min_height),"object"==typeof e.fit)?(n=e.fit[0],s=e.fit[1],this.width*(s/n)<=s?(i.width=this.width,i.height=this.width*(s/n),l=0,o=-(this.height-i.height)/2):(i.height=this.height,i.width=this.height*(n/s),o=0,l=-(this.width-i.width)/2),i.getContext("2d").drawImage(this,l,o)):(i.width=this.width,i.height=this.height,i.getContext("2d").drawImage(this,0,0));n=parseInt(n),s=parseInt(s),HERMITE.resample_single(i,n,s,!0),e.callback(i.toDataURL(0===t.target.result.indexOf("data:image/png")?"image/png":"image/jpeg",void 0!==e.quanlity?e.quanlity:1)),delete i,delete a},a.src=t.target.result}else alert(e.type.err_msg+this.file.type);else void 0!==e.type&&-1===e.type.value.indexOf(this.file.type)&&alert(e.type.err_msg+this.file.type)},t("#lumise-stages-upload-helper").click()},get_attributes:function(e){var a,i,n={},s="#f0f0f0";return t("div#lumise-stages-wrp div.fill-base-color").length>0&&""!==t("div#lumise-stages-wrp div.fill-base-color")[0].value&&(s=t("div#lumise-stages-wrp div.fill-base-color")[0].value),t("#lumise-field-attributes-items>.lumise-att-layout-item").each((function(){if(i=t(this),a=i.find('select[data-name="type"]').val(),(void 0===e||!0===e&&!0===i.find('input[data-name="use_variation"]').prop("checked"))&&(n[i.attr("data-id")]={id:i.attr("data-id"),name:i.find('input[data-name="name"]').val(),type:a,required:i.find('input[data-name="required"]').prop("checked"),use_variation:i.find('input[data-name="use_variation"]').prop("checked"),values:i.find('textarea[data-name="values"]').val().trim()}),"product_color"==a){var l=i.find('textarea[data-name="values"]').val().trim();if(""!==l)try{(l=JSON.parse(l)).options.length>0&&(s=l.options[0].value),l.options.map((function(t){t.default&&(s=t.value)}))}catch(t){}}})),t(".lumise-stage-editzone").css({"border-color":lumise.invert_color(s),color:lumise.invert_color(s)}),t("div.lumise-stage-body .lumise-stage-design-view").css({background:s}),n},get_variations:function(){var e={default:{},attrs:[],variations:{}},a=!1;return t("#lumise-variations .lumise-att-layout-default select").each((function(){e.default[this.getAttribute("data-name")]=this.value,e.attrs.push(this.getAttribute("data-name")),""!==this.value&&(a=!0)})),!1===a&&(e.default=""),t("#lumise-field-variations-items>.lumise-att-layout-item").each((function(){var a={},i=t(this),n=i.attr("data-id");i.find(".att-layout-headitem .att-layout-conditions select").each((function(){a[this.getAttribute("data-name")]=this.value})),e.variations[n]={id:n,conditions:a,price:i.find('input[data-name="price"]').val(),sku:i.find('input[data-name="sku"]').val(),minqty:i.find('input[data-name="min-qty"]').val(),maxqty:i.find('input[data-name="max-qty"]').val(),description:i.find('textarea[data-name="description"]').val(),cfgstages:i.find('input[data-name="cfgstages"]:checked').prop("checked"),cfgprinting:i.find('input[data-name="cfgprinting"]:checked').prop("checked"),stages:null,printings:null},e.variations[n].cfgstages&&(e.variations[n].stages=lumise.product.get_stages(i.find("div.lumise-stages-wrp"))),e.variations[n].cfgprinting&&(e.variations[n].printings=lumise.product.get_printing(i.find("div.att-layout-cfgprinting")))})),e},get_stages:function(e){var a={},i=!1;return e.find(".lumise_tab_content img.lumise-stage-image").each((function(){""!==this.getAttribute("data-url")&&(i=!0)})),!1===i?(alert(cfg.hs),!1):(e.find(".lumise_tab_nav li:not([data-add]) a").each((function(){let i=t(this.getAttribute("href")),n=i.find("img.lumise-stage-image").attr("data-url"),s=i.find("img.lumise-stage-image").attr("data-source"),l=i.find('input[name="is_mask"]').prop("checked"),o=i.find('input[name="pos"]').val(),d=i.find(".lumise-stage-design-view img.lumise-stage-image").get(0),r=i.find(".lumise-stage-editzone").get(0),u={},c=i.attr("data-stage");try{o=JSON.parse(o)}catch(t){if(o={template:{},edit_zone:{height:r.offsetHeight,width:r.offsetWidth,left:r.offsetLeft-d.offsetWidth/2+r.offsetWidth/2,top:r.offsetTop-d.offsetHeight/2+r.offsetHeight/2},product_width:d.offsetWidth,product_height:d.offsetHeight},i.find(".design-template-inner").length>0&&i.find(".design-template-inner").attr("data-id")){var f=i.find(".design-template-inner img").get(0);o.template={top:f.offsetTop,left:f.offsetLeft,width:f.offsetWidth,height:f.offsetHeight,natural_width:f.naturalWidth,natural_height:f.naturalHeight}}}if(i.find(".design-template-inner").length>0&&i.find(".design-template-inner").attr("data-id")){i.find(".design-template-inner img").get(0);u={id:i.find(".design-template-inner").attr("data-id"),scale:i.find(".design-scale input").val(),css:i.find(".design-template-inner img").attr("style"),offset:o.template}}let p=t(this).find('img[data-func="upload-thumbn"]'),m=i.find('select[data-name="sizes"]').val(),h=i.find('input[data-name="include_base"]').prop("checked"),g=i.find('input[data-name="crop_marks_bleed"]').prop("checked"),v=i.find('input[data-name="bleed_range"]').val();"custom"==m?m={width:i.find('input[data-name="width"]').val(),height:i.find('input[data-name="height"]').val(),constrain:i.find("span.constrain-aspect-ratio").hasClass("active"),unit:i.find('select[data-name="unit"]').val()}:""!==m&&(o.edit_zone.width=.7069555302166477*o.edit_zone.height),o.edit_zone.radius=i.find(".editzone-radius input").val(),a[c]=lumise.apply_filter("save_stage",{edit_zone:o.edit_zone,url:n,source:s,overlay:l,product_width:o.product_width,product_height:o.product_height,template:u,size:m,include_base:h,crop_marks_bleed:g,bleed_range:v,orientation:i.find('select[data-name="orientation"]').val(),label:t(this).find("text").text(),thumbnail:p.attr("data-url")?p.attr("data-url"):p.attr("src")},i),e.find("div.fill-base-color").length>0&&(a[c].color=e.find("div.fill-base-color input")[0].value)})),a=lumise.apply_filter("save_stages",a,e))},get_printing:function(e){var a={};return e.find(".lumise_checkbox").each((function(){if(t(this).find("input.action_check").prop("checked")){var e=t(this).find("input.action_check").val();a["_"+e]=""}})),a},render_values:function(e,a,i){if(e.find('textarea[data-name="values"]').length>0)i=e.find('textarea[data-name="values"]').val();if(void 0!==lumise_attribute_values_render[a]){if("string"==typeof lumise_attribute_values_render[a])try{lumise_attribute_values_render[a]=Function("wrp","$","lumise","values",lumise_attribute_values_render[a])}catch(t){console.warn(t)}"function"==typeof lumise_attribute_values_render[a]&&lumise_attribute_values_render[a](e,t,lumise,i)}else{if("string"==typeof lumise_attribute_values_render._values)try{lumise_attribute_values_render._values=Function("wrp","$","lumise","values",lumise_attribute_values_render._values)}catch(t){console.warn(t)}"function"==typeof lumise_attribute_values_render._values&&lumise_attribute_values_render._values(e,t,lumise,i)}},clone_stages:function(e,a){t("#lumise-stages-wrp ul.lumise_tab_nav").sortable("destroy");var i=t("#lumise-stages-wrp").clone(!0);i.find('.design-template-inner,.design-scale, [data-func="select-design"], [data-func="clear-design"]').remove(),i.removeAttr("id").find("ul.lumise_tab_nav>li>a[data-label]").each((function(t){var e=Math.random().toString(36).substr(6);this.setAttribute("href","#lumise-stage-"+e),i.find(".lumise_tabs>.lumise_tab_content").eq(t).attr({id:"lumise-stage-"+e,"data-stage":e}).find("div.lumise-stage-settings").attr({id:"lumise-product-design-"+e})})),e.hide().html("").append(i).slideToggle(250),i.find("ul.lumise_tab_nav").sortable({items:'>li:not([data-add="tab"])',tolerance:"pointer"}),t("#lumise-stages-wrp ul.lumise_tab_nav").sortable({items:'>li:not([data-add="tab"])',tolerance:"pointer"}),null!=a&&"object"==typeof a&&(i.find("ul.lumise_tab_nav>li:not([data-add]):not(:first-child)").remove(),i.find("div.lumise_tabs>div.lumise_tab_content:not(:first-child)").remove(),Object.keys(a).map((function(t,e){i.find("ul.lumise_tab_nav>li[data-add]").click(),0===e&&(i.find("ul.lumise_tab_nav>li:not([data-add])").first().remove(),i.find("div.lumise_tabs>div.lumise_tab_content").first().remove());var n=i.find("ul.lumise_tab_nav>li:not([data-add])").last(),s=i.find("div.lumise_tabs>div.lumise_tab_content").last(),l=a[t].url;"raws"==a[t].source?_url=lumise_assets_url+"assets/raws/"+a[t].url:-1===l.indexOf("data:image/")&&(_url=lumise_upload_url+a[t].url),n.find("a").attr({href:"#lumise-stage-"+t}).attr({"data-label":a[t].label.replace(/\"/g,"%22")}).find("text").html(a[t].label.replace(/\>/g,"%3E").replace(/\</g,"%3C")),s.find("img.lumise-stage-image").attr({src:_url,"data-url":a[t].url,"data-source":a[t].source}),s.find("div.lumise-stage-editzone").css({height:a[t].edit_zone.height+"px",width:a[t].edit_zone.width+"px",left:a[t].edit_zone.left+a[t].product_width/2-a[t].edit_zone.width/2+"px",top:a[t].edit_zone.top+a[t].product_height/2-a[t].edit_zone.height/2+"px",borderRadius:a[t].edit_zone.radius+"px"}),s.attr({"data-id":t,id:"lumise-stage-"+t,"data-stage":t}).find("div.lumise-stage-settings").attr({id:"lumise-product-design-"+t}),s.find(".lumise-stage-body").attr({"data-is-mask":a[t].overlay?"true":"false"});var o=s.find(".lumise-stage-design-view");o.attr({"data-info":o.attr("data-info").split(":")[0]+": "+a[t].edit_zone.width+"x"+a[t].edit_zone.height}).find('input[name="is_mask"]').prop({checked:a[t].overlay}),o.find(".editzone-radius input").val(a[t].edit_zone.radius),""!==a[t].size?"object"==typeof a[t].size?(o.find('select[data-name="sizes"] option[value="custom"]').prop({selected:!0}),!0===a[t].size.constrain?o.find("span.constrain-aspect-ratio").addClass("active"):o.find("span.constrain-aspect-ratio").removeClass("active"),o.find('div.edr-row[data-row="values"],div.edr-row[data-row="unit"]').show(),o.find('input[data-name="width"]').val(a[t].size.width),o.find('input[data-name="height"]').val(a[t].size.height),o.find('select[data-name="unit"] option[value="'+a[t].size.unit+'"]').prop({selected:!0})):(o.find('select[data-name="sizes"] option[value="'+a[t].size+'"]').prop({selected:!0}),o.find('div.edr-row[data-row="values"],div.edr-row[data-row="unit"]').hide()):(o.find('select[data-name="sizes"] option').first().prop({selected:!0}),o.find('div.edr-row[data-row="values"],div.edr-row[data-row="unit"]').hide()),s.find('input[name="is_mask"]').prop({checked:!1!==a[t].overlay}),o.find('select[data-name="orientation"] option[value="'+a[t].orientation+'"]').prop({selected:!0}),o.find('input[name="pos"]').val(JSON.stringify({template:void 0!==a[t].template.offset?a[t].template.offset:{},edit_zone:a[t].edit_zone,product_width:a[t].product_width,product_height:a[t].product_height}))})))},clone_printing:function(e,a){t("#lumise-tab-details .lumise_field_printing .lumise_checkboxes").sortable("destroy");var i=t("#lumise-tab-details .lumise_field_printing .lumise_form_content").clone(!0),n=e.closest(".lumise-att-layout-item").attr("data-id");i.find(".field_children").each((function(){t(this).find('.radio input[type="radio"]').each((function(){this.name+="-"+n,this.id+="-"+n,t(this).prop({checked:!1})}))})),i.find(".lumise_checkbox[data-type]").each((function(){t(this).find("input.action_check").prop({checked:!1}).get(0).id+="-"+n})),i.find("label[for]").each((function(){this.setAttribute("for",this.getAttribute("for")+"-"+n)})),i.find("em.notice, input.field-value").remove(),e.hide().html("").append(i).slideToggle(250),t("#lumise-tab-details .lumise_field_printing .lumise_checkboxes").sortable(),i.find(".lumise_checkboxes").sortable(),void 0!==a&&"object"==typeof a&&Object.keys(a).reverse().map((function(t,e){var n=t.substr(1);i.find("div.lumise_checkboxes").prepend(i.find('input.action_check[value="'+n+'"]').prop({checked:!0}).closest("div.lumise_checkbox")),""!==a[t]&&i.find('.field_children[data-parent="'+n+'"] input[type="radio"][value="'+a[t]+'"]').prop({checked:!0})}))},update_pos:function(t){var e=t.find(".lumise-stage-editzone").get(0),a=t.find("img.lumise-stage-image").get(0),i={template:{},edit_zone:{height:e.offsetHeight,width:e.offsetWidth,left:e.offsetLeft-a.offsetWidth/2+e.offsetWidth/2,top:e.offsetTop-a.offsetHeight/2+e.offsetHeight/2},product_width:a.offsetWidth,product_height:a.offsetHeight};if(t.find(".design-template-inner").length>0&&t.find(".design-template-inner").attr("data-id")){var n=t.find(".design-template-inner img").get(0);i.template={top:n.offsetTop,left:n.offsetLeft,width:n.offsetWidth,height:n.offsetHeight,natural_width:n.naturalWidth,natural_height:n.naturalHeight}}t.find('input[name="pos"]').val(JSON.stringify(i))}},template:{init:function(e){void 0!==e.bases&&(lumise.product.bases=e.bases),trigger({el:t("#lumise-template-page"),events:{"#lumise-template-form:submit":"before_submit_template"},before_submit_template:function(e){var a=t(this),i=a.find("#lumise-upload-input"),n=a.find("#lumise-upload-input-old");if(""===i.val()||i.val()==n.val())return!0;a.find(".lumise_form_submit *").hide(),a.find(".lumise_form_submit").append('<button disabled="true" class="lumise-btn" id="lumise-files-form-submitting" style="margin-left: 180px;"><i class="fa fa-spin fa-spinner"></i> Uploading..</button>');var s=new FormData;return s.append(i.attr("name"),new Blob([btoa(encodeURIComponent(i.val()))])),s.append("action","upload_fields"),s.append("nonce","LUMISE_ADMIN:"+LumiseDesign.nonce),t.ajax({data:s,type:"POST",url:LumiseDesign.ajax,contentType:!1,processData:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var a=e.loaded/e.total,i='<i class="fa fa-spin fa-spinner"></i>  '+parseInt(100*a)+"% upload complete";1===a&&(i='<i class="fa fa-spin fa-refresh"></i> Submitting..'),t("#lumise-form-submitting").html(i)}}),!1),e},success:function(e,n){(e=JSON.parse(e)).error?alert(e.error):(files=JSON.parse(decodeURIComponent(e.success)),i.val(files[i.attr("name")]),t(a).off("submit").submit())}}),!1}})}},printing:{init:function(e){var a=function(i){trigger({el:i,events:{".lumise_tab_nav li":"active_tab",":click":"tbody_funcs",'input[data-func="show_detail"]:change':"show_detail",'input[data-func="cfgpricing"]:change':"cfgpricing",'input[data-func="white-base"]:change,input[data-func="full-color"]:change':"options"},active_tab:function(e){e.preventDefault();var a=this.getAttribute("data-stage");return"stage"==this.getAttribute("data-add")?e.data.new_tab(e,this):"remove"==e.target.getAttribute("data-func")?e.data.remove_tab(e,this):(e.data.el.find(".lumise_tab_nav li.active").removeClass("active"),e.data.el.find(".lumise_tabs .lumise_tab_content").hide(),t(this).addClass("active"),void e.data.el.find('.lumise_tabs .lumise_tab_content[data-stage="'+a+'"]').show().addClass("active"))},remove_tab:function(e,a){if(2!==t(a).closest("ul.lumise_tab_nav").find(">li").length){t(a).next("li:not([data-add])").length>0?t(a).next("li:not([data-add])").click():t(a).prev("li:not([data-add])").click();var i=t(a).closest("ul.lumise_tab_nav");t(a).remove(),e.data.el.find('.lumise_tabs .lumise_tab_content[data-stage="'+a.getAttribute("data-stage")+'"]').remove(),i.find(">li:not([data-add])").each((function(e){t(this).find("text").html("Stage "+(e+1))}))}else alert(lumise.i(162))},new_tab:function(i,n){i.preventDefault();var s=t(n).closest("ul.lumise_tab_nav"),l=s.parent().find("div.lumise_tabs");id=(new Date).getTime().toString(36),s.find(">li").length>e.ops.max_stages?alert(lumise.i(163)):(s.find(">li[data-add]").before(s.find(">li").first().clone().removeClass("active").attr({"data-stage":id})),l.append(l.find(">div.lumise_tab_content").first().clone().css({display:""}).attr({"data-stage":id})),s.find(">li:not([data-add])").each((function(e){t(this).find("text").html("Stage "+(e+1))})),a(i.data.el),s.find(">li:not([data-add])").last().click())},tbody_funcs:function(t){var e=t.target.getAttribute("data-func");e&&"function"==typeof t.data[e]&&t.data[e](t)},delete_row:function(a){t(a.target).closest(".lumise_tab_content").find("tbody tr").length>1?t(a.target).closest("tr").remove():alert(e.ops.langs.nd)},add_row:function(e){var a=t(e.target).closest(".lumise_tab_content").find("tbody");last=a.find("tr").last(),a.append(last.clone());var i=a.find("tr").last().find('input[data-name="qty"]');i.val(parseInt(i.val())+5),e.preventDefault()},add_column:function(e){e.preventDefault();var a=e.target.getAttribute("data-type"),i="",n=t(e.target).closest("div.lumise_tabs").find("div.lumise_tab_content");if("color"==a)i=n.eq(0).find("thead tr td").length-2==0?prompt(LumiseDesign.js_lang[152],"Full"):(i=prompt(LumiseDesign.js_lang[152],n.eq(0).find("thead tr td").length-2)).replace(/\D/g,""),n.eq(0).find('tbody tr input[data-name="color_'+i+'"]').length>0&&(i=""),""!==i&&(i+="-color"),"Full"===i&&(i="Full-color");else if("line"==a||"character"==a){let t="line"==a?"221":"220";i=(i=prompt(LumiseDesign.js_lang[t],n.eq(0).find("thead tr td").length-2)).replace(/\D/g,""),n.eq(0).find('tbody tr input[data-name="color_'+i+'"]').length>0&&(i=""),""!==i&&(i=i+"-"+a)}else i=prompt(LumiseDesign.js_lang[155],""),i=encodeURIComponent(i.replace(/\"/g,"&quot;").replace(/\'/g,"&apos;").replace(/\%/g,"&#37;").replace(/\'/g,"&apos;").replace(/\>/g,"&gt;").replace(/\</g,"&lt;"));n.each((function(){var e=t(this);null!==i&&""!==i&&(i=i.toLowerCase(),e.find("thead tr td").last().before("<td>"+decodeURIComponent(i)+"</td>"),e.find("tbody tr").each((function(){t(this).find("td").last().before('<td><input data-name="'+i+'" value="1"></td>')})),e.parent().scrollLeft(e.width()))}))},reduce_column:function(e){var a=e.target.getAttribute("data-type");t(e.target).closest("div.lumise_tabs").find("div.lumise_tab_content").each((function(){var e=t(this).find("table");e.find("thead tr td").length>("color"==a?4:3)&&(e.find("thead tr td").last().prev().remove(),e.find("tbody tr").each((function(){t(this).find("td").last().prev().remove()})),e.parent().scrollLeft(e.width()))})),e.preventDefault()},show_detail:function(t){t.data.el.find('input[data-func="show_detail"]').prop({checked:this.checked}),e.ops.show_detail=this.checked?"1":"0"},cfgpricing:function(a){a.data.el.find('input[data-func="cfgpricing"]').prop({checked:this.checked}),e.ops.cfgpricing=this.checked?"1":"0";var i=t(a.target).closest(".lumise_tab_content").find("table"),n=t(a.target).closest(".lumise_radio_content"),s=n.data("type"),l=this.checked;"color"==s&&(l?(n.find("div[data-option]").show(),n.find('input[data-func="full-color"],input[data-func="white-base"]').trigger("change")):n.find("div[data-option]").hide()),l?n.find('a[data-func="add_column"],a[data-func="reduce_column"]').show():n.find('a[data-func="add_column"],a[data-func="reduce_column"]').hide(),i.find("tr").each((function(){l?t(this).find("td:not(:first-child):not(:last-child)").each((function(e){e>0?t(this).removeClass("hidden"):t(this).addClass("hidden")})):t(this).find("td:not(:first-child):not(:last-child)").each((function(e){e>0?t(this).removeAttr("style").addClass("hidden"):t(this).removeClass("hidden")}))}))},options:function(a){var i=a.target.getAttribute("data-func"),n=this.checked;t(a.target).prop({checked:this.checked}),t(a.target).closest(".lumise_tab_content").find("table").find("tr").each((function(){n&&0!=e.ops.cfgpricing?t(this).find("td.column-"+i).show():t(this).find("td.column-"+i).hide()}))}},!0)};trigger({el:t(".lumise_field_print"),events:{'input[data-func="type"]:change':"change_type",'input[data-func="multi"]:change':"change_multi"},change_type:function(e){var a=e.data.el.find('input[data-func="multi"]').is(":checked"),i=t(this).closest(".lumise_radios").find(".lumise_radio_content");e.data.el.find(".lumise_radio_content").removeClass("lumise-open").attr({"data-multi":a?"yes":"no"}),i.addClass("lumise-open"),""===i.html()&&e.data.render_tabs(e,this),t(".lumise_radio_content.lumise-open input[data-func]").trigger("change")},change_multi:function(e){e.data.el.find(".lumise_radio_content").attr({"data-multi":this.checked?"yes":"no"}),this.checked||t(e.data.el).find(".lumise_radio_content.lumise-open").find(".lumise_tab_nav a").first().trigger("click")},render_tabs:function(i,n){var s=t(n).closest(".lumise_radios").find(".lumise_radio_content"),l=((new Date).getTime().toString(36),t('<ul class="lumise_tab_nav"></ul>')),o=t('<div class="lumise_tabs"></div>'),d=t('<div class="tab_option"></div>');"object"==typeof e.ops.data[n.value].values&&0!=Object.keys(e.ops.data[n.value].values).length||(e.ops.data[n.value].values={id:e.ops.data[n.value].default}),Object.keys(e.ops.data[n.value].values).map((function(t,e){l.append('<li class="active" data-stage="'+t+'">\t\t\t\t\t\t\t\t\t<a href="#active-tab">\t\t\t\t\t\t\t\t\t\t<text>Stage '+(e+1)+'</text>\t\t\t\t\t\t\t\t\t\t<svg data-func="remove" height="16px" width="16px" viewBox="-75 -75 370 370"><path data-func="remove" d="M131.804,106.491l75.936-75.936c6.99-6.99,6.99-18.323,0-25.312   c-6.99-6.99-18.322-6.99-25.312,0l-75.937,75.937L30.554,5.242c-6.99-6.99-18.322-6.99-25.312,0c-6.989,6.99-6.989,18.323,0,25.312   l75.937,75.936L5.242,182.427c-6.989,6.99-6.989,18.323,0,25.312c6.99,6.99,18.322,6.99,25.312,0l75.937-75.937l75.937,75.937   c6.989,6.99,18.322,6.99,25.312,0c6.99-6.99,6.99-18.322,0-25.312L131.804,106.491z"></path></svg>\t\t\t\t\t\t\t\t\t</a>\t\t\t\t\t\t\t\t</li>'),o.append('<div class="lumise_tab_content" data-stage="'+t+'">'+i.data.render_table(i,n.value,t)+"</div>")})),l.append('<li data-add="stage"><a href="#new"><i class="fa fa-plus"></i></a></li>'),"acreage"!=n.value&&"fixed"!=n.value&&"acreage "!=n.value&&d.append('<div data-view="advance">\t\t\t\t\t\t\t\t\t<div class="lumise-toggle">\t\t\t\t\t\t\t\t\t\t<input type="checkbox" data-func="cfgpricing" value="1" '+("1"==e.ops.cfgpricing?" checked":"")+'>\t\t\t\t\t\t\t\t\t\t<span class="lumise-toggle-label" data-on="Yes" data-off="No"></span>\t\t\t\t\t\t\t\t\t\t<span class="lumise-toggle-handle"></span>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t<label>Advance option</label>\t\t\t\t\t\t\t\t</div>'),"color"==n.value&&e.ops.data[n.value].options&&Object.keys(e.ops.data[n.value].options).map((function(t,a){"ppu"==t||d.append('<div data-option="'+t+'" class="hidden">\t\t\t\t\t\t\t\t\t<div class="lumise-toggle">\t\t\t\t\t\t\t\t\t\t<input type="checkbox" data-func="'+t+'" value="1" '+("1"==e.ops[t.replace("-","_")]?" checked":"")+'>\t\t\t\t\t\t\t\t\t\t<span class="lumise-toggle-label" data-on="Yes" data-off="No"></span>\t\t\t\t\t\t\t\t\t\t<span class="lumise-toggle-handle"></span>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t<label>'+e.ops.data[n.value].options[t]+"</label>\t\t\t\t\t\t\t\t</div>")})),s.append(d),s.append(l).append(o),a(s),l.find(">li").first().click()},render_table:function(t,a,i){var n,s="<thead><tr><td>"+e.ops.langs.qr+"</td>";void 0!==e.ops.data[a].values&&void 0!==e.ops.data[a].values[i]?n=e.ops.data[a].values[i]:(n=void 0!==e.ops.data[a].values?e.ops.data[a].values[Object.keys(e.ops.data[a].values)[0]]:e.ops.data[a].default,Object.keys(n).map((function(t,e){e>0&&delete n[t]}))),"acreage"!=a&&"fixed"!=a||(e.ops.cfgpricing=!1),Object.keys(n[Object.keys(n)[0]]).map((function(t,i){var n=["column-"+t];(e.ops.cfgpricing&&0==i||!e.ops.cfgpricing&&i>0)&&n.push("hidden"),s+='<td class="'+n.join(" ")+'">'+(e.ops.data[a][t]?decodeURIComponent(e.ops.data[a][t]):decodeURIComponent(t))+"</td>"}));var l=t.data.render_rows(n);return'<div data-view="table"><table>'+(s+="<td></td></tr></thead>")+l+'</table></div>\t\t\t\t\t\t\t\t<a href="#" data-func="add_row">'+e.ops.langs.aqr+"</a>"+("color"==a||"size"==a||"character"==a||"line"==a?' <a href="#" data-func="add_column" data-type="'+a+'">'+LumiseDesign.js_lang[153]+'</a> \t\t\t\t\t\t\t\t\t <a href="#" data-func="reduce_column" data-type="'+a+'">'+LumiseDesign.js_lang[154]+"</a>":"")+'<input type="checkbox" data-func="show_detail" id="showindt-'+a+'"'+("1"==e.ops.show_detail?" checked":"")+' /> &nbsp; <label for="showindt-'+a+'">Show in details?</label>'},render_rows:function(t){var a="<tbody>";return Object.keys(t).map((function(i){a+='<tr><td><input data-name="qty" value="'+i+'" /></td>',Object.keys(t[i]).map((function(n,s){var l="",o=["column-"+n];void 0!==t[i][n]&&(l=t[i][n]),(e.ops.cfgpricing&&0==s||!e.ops.cfgpricing&&s>0)&&o.push("hidden"),a+='<td class="'+o.join(" ")+'"><input data-name="'+n+'" value="'+l+'" /></td>'})),a+='<td><i class="fa fa-times" data-func="delete_row"></i></td></tr>'})),a+"</tbody>"}},"prt"),t('.lumise_field_print input[data-func="type"]:checked').trigger("change"),t(".lumise_form").on("submit",(function(e){t(".lumise_field_print").each((function(){var e=t(this),a=function(e){var a,i={};return e.find("tbody tr").each((function(){a=t(this).find('input[data-name="qty"]').val(),i[a]={},t(this).find('input:not([data-name="qty"])').each((function(){i[a][this.getAttribute("data-name")]=this.value}))})),i},i={multi:e.find('input[data-func="multi"]').is(":checked"),type:e.find('input[data-func="type"]:checked').val(),show_detail:e.find('.lumise-open input[data-func="show_detail"]').eq(0).is(":checked")?"1":"0",white_base:e.find('.lumise-open input[data-func="white-base"]').eq(0).is(":checked")?"1":"0",full_color:e.find('.lumise-open input[data-func="full-color"]').eq(0).is(":checked")?"1":"0",cfgpricing:e.find('input[data-func="cfgpricing"]').is(":checked"),values:{}},n=e.find(".lumise_radio_content.lumise-open");if(i.multi)n.find(".lumise_tab_content").each((function(){i.values[this.getAttribute("data-stage")]=a(t(this))}));else{var s=n.find(".lumise_tab_content").first();i.values[s.attr("data-stage")]=a(s)}e.find('input[data-func="data-saved"]').val(btoa(encodeURIComponent(JSON.stringify(i))))})),t(".lumise_field_advance_option").each((function(){var e=t(this),a={active:e.find('input[data-func="active"]').is(":checked")?1:0,values:{}};e.find(":input:not([data-func])").each((function(){var e=this.name.indexOf("[]")>-1?this.name.split("[]")[0]:this.name,i=this.value,n=a.values[e];if("checkbox"==this.type||"radio"==this.type)if(this.name.indexOf("[]")>-1){if(!this.checked)return;i=this.value}else i=this.checked?1:0;null!=n?t.isArray(n)?n.push(i):a.values[e]=[n,i]:a.values[e]=i})),e.find('input[data-func="data-saved"]').val(btoa(encodeURIComponent(JSON.stringify(a))))}))})),trigger({el:t(".lumise_field_advance_option"),events:{'input[data-func="active"]:change':"change_active"},change_active:function(e){this.checked?t(this).closest(".lumise_form_content").find(".lumise_form_group").show():t(this).closest(".lumise_form_content").find(".lumise_form_group").hide()}},!0),t('.lumise_field_advance_option input[data-func="active"]').trigger("change")}},svguni:function(e){if(-1===e.indexOf("image/svg+xml"))return e;(e=e.split(","))[1]=t("<div>"+atob(e[1].replace("viewbox=","viewBox="))+"</div>"),e[1].find("[id]").each((function(){this.id=this.id.replace(/[\u{0080}-\u{FFFF}]/gu,"")}));var a=e[1].find("svg").get(0);if(a.getAttribute("width")||a.setAttribute("width","1000px"),!a.getAttribute("height")){var i=a.getAttribute("viewBox").trim().split(" ");a.setAttribute("height",parseFloat(i[3])/parseFloat(i[2])*1e3+"px")}return e[1]=btoa(e[1].html()),e[0]+","+e[1]},slugify:function(t){var e="àáạäâãấầẫậạăắằẵặèéëêếềễẹệìíĩïîịòóöôốồỗộọùúüûũụùúũđñçßÿœæŕśńṕẃǵǹḿǘẍźḧ·/_,:;",a=new RegExp(e.split("").join("|"),"g");return t.toString().toLowerCase().replace(/\s+/g,"-").replace(a,(function(t){return"aaaaaaaaaaaaaaaaeeeeeeeeeiiiiiiooooooooouuuuuuuuudncsyoarsnpwgnmuxzh------".charAt(e.indexOf(t))})).replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},invert_color:function(t){var e,a,i;if(t.indexOf("rgb")>-1)t=t.split(","),e=parseInt(t[0].trim()),a=parseInt(t[1].trim()),i=parseInt(t[2].trim());else{t.length<6&&(t+=t.replace("#",""));var n="#"==t.charAt(0)?t.substring(1,7):t.substring(0,6);e=parseInt(n.substring(0,2),16)/255*.213,a=parseInt(n.substring(2,4),16)/255*.715,i=parseInt(n.substring(4,6),16)/255*.072}return e+a+i<.5?"#DDD":"#333"},esc:function(t){return"string"==typeof t?t.trim().replace(/\"/g,"&#x22;"):""}},t(document).ready((function(t){t('div.lumise_form_content .lumise-toggle input[name="is_mask"]').parents("div.lumise_form_content").append('<button class="button btn_fix_bug" style="cursor: pointer;margin-left: 7px;padding: 5px 5px;">Update position</button>');var e={"#000000":"black","#000080":"navy","#00008b":"darkblue","#0000cd":"mediumblue","#0000ff":"blue","#006400":"darkgreen","#008000":"green","#008080":"teal","#008b8b":"darkcyan","#00bfff":"deepskyblue","#00ced1":"darkturquoise","#00fa9a":"mediumspringgreen","#00ff00":"lime","#00ff7f":"springgreen","#00ffff":"cyan","#191970":"midnightblue","#1e90ff":"dodgerblue","#20b2aa":"lightseagreen","#228b22":"forestgreen","#2e8b57":"seagreen","#2f4f4f":"darkslategrey","#32cd32":"limegreen","#3cb371":"mediumseagreen","#40e0d0":"turquoise","#4169e1":"royalblue","#4682b4":"steelblue","#483d8b":"darkslateblue","#48d1cc":"mediumturquoise","#4b0082":"indigo","#556b2f":"darkolivegreen","#5f9ea0":"cadetblue","#6495ed":"cornflowerblue","#663399":"rebeccapurple","#66cdaa":"mediumaquamarine","#696969":"dimgrey","#6a5acd":"slateblue","#6b8e23":"olivedrab","#708090":"slategrey","#778899":"lightslategrey","#7b68ee":"mediumslateblue","#7cfc00":"lawngreen","#7fff00":"chartreuse","#7fffd4":"aquamarine","#800000":"maroon","#800080":"purple","#808000":"olive","#808080":"grey","#87ceeb":"skyblue","#87cefa":"lightskyblue","#8a2be2":"blueviolet","#8b0000":"darkred","#8b008b":"darkmagenta","#8b4513":"saddlebrown","#8fbc8f":"darkseagreen","#90ee90":"lightgreen","#9370db":"mediumpurple","#9400d3":"darkviolet","#98fb98":"palegreen","#9932cc":"darkorchid","#9acd32":"yellowgreen","#a0522d":"sienna","#a52a2a":"brown","#a9a9a9":"darkgrey","#add8e6":"lightblue","#adff2f":"greenyellow","#afeeee":"paleturquoise","#b0c4de":"lightsteelblue","#b0e0e6":"powderblue","#b22222":"firebrick","#b8860b":"darkgoldenrod","#ba55d3":"mediumorchid","#bc8f8f":"rosybrown","#bdb76b":"darkkhaki","#c0c0c0":"silver","#c71585":"mediumvioletred","#cd5c5c":"indianred","#cd853f":"peru","#d2691e":"chocolate","#d2b48c":"tan","#d3d3d3":"lightgrey","#d8bfd8":"thistle","#da70d6":"orchid","#daa520":"goldenrod","#db7093":"palevioletred","#dc143c":"crimson","#dcdcdc":"gainsboro","#dda0dd":"plum","#deb887":"burlywood","#e0ffff":"lightcyan","#e6e6fa":"lavender","#e9967a":"darksalmon","#ee82ee":"violet","#eee8aa":"palegoldenrod","#f08080":"lightcoral","#f0e68c":"khaki","#f0f8ff":"aliceblue","#f0fff0":"honeydew","#f0ffff":"azure","#f4a460":"sandybrown","#f5deb3":"wheat","#f5f5dc":"beige","#f5f5f5":"whitesmoke","#f5fffa":"mintcream","#f8f8ff":"ghostwhite","#fa8072":"salmon","#faebd7":"antiquewhite","#faf0e6":"linen","#fafad2":"lightgoldenrodyellow","#fdf5e6":"oldlace","#ff0000":"red","#ff00ff":"magenta","#ff1493":"deeppink","#ff4500":"orangered","#ff6347":"tomato","#ff69b4":"hotpink","#ff7f50":"coral","#ff8c00":"darkorange","#ffa07a":"lightsalmon","#ffa500":"orange","#ffb6c1":"lightpink","#ffc0cb":"pink","#ffd700":"gold","#ffdab9":"peachpuff","#ffdead":"navajowhite","#ffe4b5":"moccasin","#ffe4c4":"bisque","#ffe4e1":"mistyrose","#ffebcd":"blanchedalmond","#ffefd5":"papayawhip","#fff0f5":"lavenderblush","#fff5ee":"seashell","#fff8dc":"cornsilk","#fffacd":"lemonchiffon","#fffaf0":"floralwhite","#fffafa":"snow","#ffff00":"yellow","#ffffe0":"lightyellow","#fffff0":"ivory","#ffffff":"white"},a=function(e){e.preventDefault();var a={type:t(this).attr("data-type"),action:t(this).attr("data-action"),id:t(this).attr("data-id"),status:t(this).attr("data-status"),verify:t(this).attr("check-license")},i=t(this);i.html('<i class="fa fa-spinner fa-spin"></i>'),t.ajax({url:LumiseDesign.ajax,method:"POST",data:{action:"switch_status",nonce:"LUMISE_ADMIN:"+LumiseDesign.nonce,data:a},dataType:"json",statusCode:{403:function(){alert(LumiseDesign.js_lang.error_403)}},success:function(e){if(void 0!==e.verify&&void 0!==e.id&&0==e.verify)return"vendors"==e.id?t("#link-addon-vendor").css("display","block"):"printful"==e.id?t("#link-addon-printful").css("display","block"):t("#link-addon-bundle").css("display","block"),i.html('<em class="un pub">'+lumise.i(86)+"</em>"),void t("#license_noticesModal").css("display","block");if("success"==e.status){"switch_feature"==e.action&&(1==e.value?(i.html("<i class='fa fa-star'></i>"),i.attr("data-status",1)):(i.html("<i class='none fa fa-star-o'></i>"),i.attr("data-status",0)));var n=i.closest("tr").find("td[data-name]");"switch_active"==e.action&&(1==e.value?(i.html('<em class="pub">'+lumise.i(85)+"</em>"),i.attr("data-status",1),"addons"==a.type&&n.html('<a href="'+LumiseDesign.admin_url+"lumise-page=addon&name="+n.attr("data-slug")+'">'+decodeURIComponent(n.attr("data-name"))+"</a>")):(i.html('<em class="un pub">'+lumise.i(86)+"</em>"),i.attr("data-status",0),"addons"==a.type&&n.html(decodeURIComponent(n.attr("data-name")))))}else alert(e.value)}})},s=function(e){e.preventDefault(),this.setAttribute("data-working","true");var i={id:t(this).attr("data-id"),table:t(this).attr("data-table")},n=t(this),l=n.closest("tr");n.attr({"data-working":"true"}),t.ajax({url:LumiseDesign.ajax,method:"POST",data:{action:"duplicate_item",nonce:"LUMISE_ADMIN:"+LumiseDesign.nonce,data:i},dataType:"json",statusCode:{403:function(){alert(LumiseDesign.js_lang.error_403)}},success:function(e){if(n.attr({"data-working":"false"}),null!==e&&"success"==e.status){var i=l.clone(),o=i.find(".lumise_checkbox input"),d=i.find(".lumise_checkbox label"),r=i.find(".lumise_action"),u=i.find(".name");u.attr("href",e.data.url),u.html(e.data.name),o.attr("value",e.data.id),o.attr("id",e.data.id),o.attr("id",e.data.id),d.attr("for",e.data.id),r.attr("data-id",e.data.id),l.after(i);var c=i.find("input[name='checked[]']:checked").map((function(){return t(this).val()})).get();i.find(".id_action").val(c),trigger({el:i,events:{".lumise_action":a,".lumise_action_duplicate":s,".action_check:change":function(e){var a=t("input[name='checked[]']:checked").map((function(){return t(this).val()})).get();t(".id_action").val(a)}}})}else null!==e&&alert(e.value)}})};trigger({el:t("body"),events:{"#check_all":"check_all",".action_check":"action_check",".lumise_action":a,".lumise_action_duplicate":s,".lumise_menu > li > a":"left_menu",".btn-toggle-sidebar":"toggle_menu",".btn-toggle-sidebar-mb":"toggle_menu_mb",".overlay_mb":"overlay_mb",".lumise_tab_nav":"tab_click","[data-file-select]:change":"select_file","[data-file-delete]":"delete_upload",".lumise_support_icon":"button_help",".lumise-field-color":"change_color",'.lumise-field-color-wrp [data-func="create-color"]':"create_color",'.lumise-field-color-wrp button[data-func="clear-color"]':"clear_color",'[data-action="submit"]:change':"do_submit","#lumise-product-form:submit":"check_submit",".lumise-field-google_fonts":"google_fonts",".lumise-item-action":"items_action",'a[href="#report-bug"]':"report_bug","button.loaclik":function(){this.innerHTML='<i style="font-size: 16px;" class="fa fa-circle-o-notch fa-spin fa-fw"></i> please wait..'}},items_action:function(e){e.preventDefault();var a=t(this).attr("data-func"),i=t(this).attr("data-item");switch(a){case"delete":1==confirm(lumise.i(121))&&t("<form>",{id:"lumise-item-delete",method:"POST",html:'<input type="hidden" name="id" value="'+i+'"/><input type="hidden" name="do" value="action"/><input type="hidden" name="action_submit" value="action"/><input type="hidden" name="action" value="delete"/><input type="hidden" name="nonce" value="LUMISE_ADMIN:'+LumiseDesign.nonce+'"/>',action:window.location.href}).appendTo(document.body).submit()}},button_help:function(e){t(this).toggleClass("open"),t(this).parents().find(".lumise_list_icon").toggleClass("open")},check_all:function(){t(".action_check").prop("checked",this.checked);var e=t("input[name='checked[]']:checked").map((function(){return t(this).val()})).get();t(".id_action").val(e)},action_check:function(){var e=t("input[name='checked[]']:checked").map((function(){return t(this).val()})).get();t(".id_action").val(e)},left_menu:function(e){if(0!=(s=t(this).next()).length){e.preventDefault();var a=0,i=t(this).parent(),n=this,s=i.find(".lumise_sub_menu");t(".lumise_icon_dropdown").removeClass("open"),t(".lumise_sub_menu.open").css({height:0}).removeClass("open"),void 0===t(this).attr("data-height")&&(t(s).find("li").each((function(e){a+=t(this).outerHeight()})),t(this).attr("data-height",a)),"0px"==t(this).next().css("height")&&(t(this).find(".lumise_icon_dropdown").addClass("open"),t(s).toggleClass((function(){return t(this).is(".open")?t(s).css({height:0}):t(s).css({height:t(n).attr("data-height")}),"open"})))}},toggle_menu:function(){t(this).parents(".lumise_sidebar").toggleClass("menu_icon"),t(this).parents("body").toggleClass("page_sidebar_mini")},toggle_menu_mb:function(){t(this).parents(".lumise_mobile").toggleClass("open")},overlay_mb:function(){t(this).parent(".lumise_mobile").toggleClass("open")},tab_click:function(e){if("remove"==e.target.getAttribute("data-func")){if(e.preventDefault(),t(this).find(">li").length<=2)return void alert(lumise.i(162));var a=t(e.target).closest("a").attr("href");return t(".lumise-stages-wrp").each((function(){t(this).find('ul.lumise_tab_nav a[href="'+a+'"]').parent().prev().length>0?t(this).find('ul.lumise_tab_nav a[href="'+a+'"]').parent().prev().find("a").click():t(this).find('ul.lumise_tab_nav a[href="'+a+'"]').parent().next().length>0&&t(this).find('ul.lumise_tab_nav a[href="'+a+'"]').parent().next().find("a").click(),t(this).find('ul.lumise_tab_nav a[href="'+a+'"]').parent().remove()})),void t(a).remove()}if("A"==e.target.tagName||"A"==e.target.parentNode.tagName){var i="A"==e.target.tagName?t(e.target):t(e.target).closest("a"),n=i.attr("href"),s=t(this).closest(".lumise_tab_nav"),l=t(this).closest(".lumise_tabs_wrapper");if(i.parent().hasClass("active")||0===t(n).length)e.preventDefault();else{if(l.find(">.lumise_tabs>.lumise_tab_content").hide().removeClass("active"),s.find(">li").removeClass("active"),i.parent().addClass("active"),t(n).css("display","block").addClass("active"),""!==l.attr("data-id")){var o=localStorage.getItem("LUMISE-TABS");(o=o?JSON.parse(o):{})[l.attr("data-id")]=n,localStorage.setItem("LUMISE-TABS",JSON.stringify(o))}e.preventDefault()}}},select_file:function(e){var a=this.getAttribute("data-file-select"),i=this.getAttribute("data-file-preview"),n=this,s=function(t){return n.getAttribute("data-"+t)};if(this.files&&this.files[0]){if("font"!=a&&"design"!=a&&!lumise_validate_file(this.files[0]))return alert("Error: Invalid upload file");var l=new FileReader;l.file=this.files[0],l.onload=function(e){var n=lumise.svguni(e.target.result);if("font"==a?lumise_font_preview(Math.random().toString(36).substr(2).replace(/\d/g,""),"url("+n+")",i):"design"!=a&&s("file-preview")&&t(s("file-preview")).attr("src",n),s("file-input")){var l={data:n,size:this.file.size,name:"lumise-media-"+this.file.name.replace(/[^0-9a-zA-Z\.\-\_]/g,"").trim().replace(/\ /g,"+"),type:this.file.type?this.file.type:this.file.name.split(".").pop(),old:t(s("file-input")+"-old").val(),path:t(s("file-input")).attr("data-path")};if(s("file-thumbn-width")||s("file-thumbn-height"))lumise_create_thumbn({source:n,width:s("file-thumbn-width")||null,height:s("file-thumbn-height")||null,callback:function(e){l.thumbn=e,s("file-preview")&&t(s("file-preview")).attr("src",e),t(s("file-input")).val(JSON.stringify(l))}});else if("design"==a)if(l.thumbn=d,n.indexOf("data:application/octet-stream")>-1){var o=JSON.parse(decodeURIComponent(atob(n.split("base64,")[1]))),d=o.stages[Object.keys(o.stages)[0]].screenshot;t(s("file-preview")).attr("src",d),l.thumbn=d,t(s("file-input")).val(JSON.stringify(l))}else n.indexOf("data:image/")>-1&&lumise_create_thumbn({source:n,width:500,height:null,callback:function(e,a){l.thumbn=e,l.data=a.src,l.name=(new Date).getTime().toString(36)+"."+(a.src.indexOf("data:image/png")>-1?"png":"jpg"),t(s("file-preview")).attr("src",e),t(s("file-input")).val(JSON.stringify(l))}});else t(s("file-input")).val(JSON.stringify(l))}},l.readAsDataURL(this.files[0])}},delete_upload:function(e){var a=this,i=function(t){return a.getAttribute("data-"+t)};return i("file-preview")&&t(i("file-preview")).attr("src","").html(""),i("file-input")&&t(i("file-input")).val(""),i("file-thumbn")&&t(i("file-thumbn")).val(""),t("#font-ttf-upload").hide(),e.preventDefault(),!1},change_color:function(e){var a=e.target.getAttribute("data-color"),i=t(this).closest(".lumise-field-color-wrp");if(a){if("delete"==a)return t(e.target.parentNode).remove(),void e.data.return_colors(i);i.find("li[data-color].choosed").removeClass("choosed"),i.find('input[data-el="select"]').val(a),t(e.target).addClass("choosed"),e.data.return_colors(i)}},create_color:function(a){var i=t(a.target),n=function(a,i){"object"!=typeof i&&(i=[]),a.length>0?a.map((function(t,n){t=decodeURIComponent(t).split("@"),a[n]='<li style="border-left: 20px solid '+t[0]+'" data-color="'+t[0]+'"><span>'+(void 0!==t[1]&&""!==t[1]?decodeURIComponent(t[1]).replace(/\"/g,""):void 0!==e[t]?e[t]:t)+'</span> <input type="checkbox" '+(i.indexOf(t)>-1?"checked ":"")+' />\t\t\t\t\t\t\t\t\t\t<i class="fa fa-check"></i>\t\t\t\t\t\t\t\t\t</li>'})):a=['<p class="empty">'+LumiseDesign.js_lang[144]+"</p>"];var l="";Object.keys(e).map((function(t){l+='<li data-color="'+t+'" style="color: '+t+'">'+e[t]+"</li>"})),t("#lumise-list-colors-body").html('<div class="col">\t\t\t\t\t\t\t\t<h3>'+LumiseDesign.js_lang[145]+'</h3>\t\t\t\t\t\t\t\t<div class="create-color-grp">\t\t\t\t\t\t\t\t\t<input type="text" name="label" placeholder="Color Label" />\t\t\t\t\t\t\t\t\t<input type="text" name="hex" placeholder="Color HEX" />\t\t\t\t\t\t\t\t\t<input type="color" /> \t\t\t\t\t\t\t\t\t<span>Color <br>picker</span>\t\t\t\t\t\t\t\t\t<p class="style_color_btn">\t\t\t\t\t\t\t\t\t\t<button data-func="apply-now">'+LumiseDesign.js_lang.apply+' <i class="fa fa-check"></i></button>\t\t\t\t\t\t\t\t\t\t<button data-func="add-list">'+LumiseDesign.js_lang[140]+' <i class="fa fa-arrow-right"></i></button>\t\t\t\t\t\t\t\t\t</p>\t\t\t\t\t\t\t\t\t<ul class="color-names">'+l+'</ul>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="col">\t\t\t\t\t\t\t\t<h3>\t\t\t\t\t\t\t\t\t'+LumiseDesign.js_lang[143]+'\t\t\t\t\t\t\t\t\t<a href="#unselectall">'+LumiseDesign.js_lang[142]+'</a>\t\t\t\t\t\t\t\t\t<a href="#selectall">'+LumiseDesign.js_lang[141]+'</a>\t\t\t\t\t\t\t\t\t<a href="#delete">'+LumiseDesign.js_lang[146]+'</a>\t\t\t\t\t\t\t\t</h3>\t\t\t\t\t\t\t\t<ul class="colors-ul">'+a.join("")+"</ul>\t\t\t\t\t\t\t</div>"),trigger({el:t("#lumise-list-colors"),events:{":click":function(t){"lumise-list-colors"==t.target.id&&t.data.el.remove()},".close-pop":"close_pop",".pop-save":"pop_save",".colors-ul li":"select_color",'a[href="#selectall"]':"select_all",'a[href="#unselectall"]':"unselect_all",'a[href="#delete"]':"delete_selection",'.create-color-grp input[type="color"]:input':"color_picker",".color-names li":"color_name",'button[data-func="add-list"]':"add_list",'button[data-func="apply-now"]':"apply_now"},close_pop:function(t){t.data.el.remove(),t.preventDefault()},pop_save:function(e){var a=[];e.data.el.find("ul.colors-ul li").each((function(){!0===t(this).find('input[type="checkbox"]').prop("checked")&&a.push(this.getAttribute("data-color")+"@"+encodeURIComponent(t(this).find("span").text()))})),a.length>0&&s(a),e.preventDefault(),t("#lumise-list-colors").remove()},select_color:function(e){var a=t(this).find('input[type="checkbox"]');a.length&&a.attr({checked:!a.is(":checked")})},select_all:function(t){t.data.el.find('.colors-ul input[type="checkbox"]').attr({checked:!0}),t.preventDefault()},unselect_all:function(t){t.data.el.find('.colors-ul input[type="checkbox"]').attr({checked:!1}),t.preventDefault()},delete_selection:function(e){if(confirm(LumiseDesign.js_lang.sure)){var a=[];e.data.el.find("ul.colors-ul li").each((function(){!0===t(this).find('input[type="checkbox"]').prop("checked")?t(this).remove():a.push(this.getAttribute("data-color")+"@"+encodeURIComponent(t(this).find("span").text()))})),t.ajax({url:LumiseDesign.ajax,method:"POST",data:{nonce:"LUMISE_ADMIN:"+LumiseDesign.nonce,ajax:"backend",action:"list_colors",save_action:a.join(",")}})}},color_picker:function(t){t.data.el.find('.create-color-grp input[name="hex"]').val(this.value),""===t.data.el.find('.create-color-grp input[name="label"]').val()&&t.data.el.find('.create-color-grp input[name="label"]').val(void 0!==e[this.value]?e[this.value]:"")},color_name:function(t){t.data.el.find('.create-color-grp input[type="color"]').val(this.getAttribute("data-color")),t.data.el.find('.create-color-grp input[name="label"]').val(e[this.getAttribute("data-color")]),t.data.el.find('.create-color-grp input[name="hex"]').val(this.getAttribute("data-color"))},check_color:function(t){var a,i=t.data.el.find('.create-color-grp input[name="hex"]'),n=t.data.el.find('.create-color-grp input[name="label"]').val(),s=i.val().toLowerCase().trim();return s.indexOf("rgb")>-1&&(s=0===(a=s).indexOf("#")?a:(a=a.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===a.length?"#"+("0"+parseInt(a[1],10).toString(16)).slice(-2)+("0"+parseInt(a[2],10).toString(16)).slice(-2)+("0"+parseInt(a[3],10).toString(16)).slice(-2):"",i.val(s)),Object.values(e).indexOf(s)>-1&&(s=Object.keys(e).filter((function(t){return e[t].toLowerCase()==s}))[0],i.val(s)),""===s||7!=s.length||0!==s.indexOf("#")?(t.data.el.find('.create-color-grp input[name="hex"]').shake(),!1):s+"@"+encodeURIComponent(n)},add_list:function(e){e.preventDefault();var a=e.data.check_color(e);if(!1!==a){var i=[],s=[];i.push(encodeURIComponent(a)),e.data.el.find(".colors-ul li").each((function(){i.push(encodeURIComponent(this.getAttribute("data-color")+"@"+encodeURIComponent(t(this).find("span").text().trim()))),!0===t(this).find('input[type="checkbox"]').prop("checked")&&s.push(this.getAttribute("data-color"))})),t.ajax({url:LumiseDesign.ajax,method:"POST",data:{nonce:"LUMISE_ADMIN:"+LumiseDesign.nonce,ajax:"backend",action:"list_colors",save_action:i.join(",")}}),n(i,s)}},apply_now:function(t){t.preventDefault();var e=t.data.check_color(t);!1!==e&&s([e])}})},s=function(e){i.prev().val();var n=i.closest(".lumise-field-color-wrp");e.map((function(t){t=t.split("@"),0===n.find('li[data-color="'+t[0]+'"]').length&&("lumise-product-colors"==n.attr("id")?n.find('ul.lumise-field-color li[data-add="color"]').before('<li data-color="'+t[0]+'" data-label="'+(void 0!==t[1]?t[1].toString():"")+'"><span data-func="color" style="background:'+t[0]+'"></span><i class="fa fa-times" data-func="delete"></i></li>'):n.find("ul.lumise-field-color").append('<li data-color="'+t[0]+'" style="background:'+t[0]+'" data-label="'+(void 0!==t[1]?decodeURIComponent(t[1]).replace(/\"/g,"&quot;"):"")+'"><i class="fa fa-times" data-color="delete"></i></li>')),n.find('li[data-color="'+t[0]+'"]').animate({opacity:.1},350).delay(50).animate({opacity:1},350)})),a.preventDefault(),"function"==typeof a.data.ex_return_colors?a.data.ex_return_colors(n):a.data.return_colors(n),t("#lumise-list-colors").remove()};t("body").append('<div id="lumise-list-colors" class="lumise-popup" style="display:block">\t\t\t\t\t\t<div class="lumise-popup-content">\t\t\t\t\t\t\t<header>\t\t\t\t\t\t\t\t<h3>'+LumiseDesign.js_lang[139]+'</h3>\t\t\t\t\t\t\t\t<span class="pop-save" title="'+LumiseDesign.js_lang.save+'"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="-150 -150 750 750" height="32px" width="32px" xml:space="preserve"><path d="M506.231,75.508c-7.689-7.69-20.158-7.69-27.849,0l-319.21,319.211L33.617,269.163c-7.689-7.691-20.158-7.691-27.849,0    c-7.69,7.69-7.69,20.158,0,27.849l139.481,139.481c7.687,7.687,20.16,7.689,27.849,0l333.133-333.136    C513.921,95.666,513.921,83.198,506.231,75.508z"></path></svg></span>\t\t\t\t\t\t\t\t<span class="close-pop" title="'+LumiseDesign.js_lang.close+'"><svg enable-background="new 0 0 32 32" height="32px" id="close" version="1.1" viewBox="-4 -4 40 40" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M17.459,16.014l8.239-8.194c0.395-0.391,0.395-1.024,0-1.414c-0.394-0.391-1.034-0.391-1.428,0  l-8.232,8.187L7.73,6.284c-0.394-0.395-1.034-0.395-1.428,0c-0.394,0.396-0.394,1.037,0,1.432l8.302,8.303l-8.332,8.286  c-0.394,0.391-0.394,1.024,0,1.414c0.394,0.391,1.034,0.391,1.428,0l8.325-8.279l8.275,8.276c0.394,0.395,1.034,0.395,1.428,0  c0.394-0.396,0.394-1.037,0-1.432L17.459,16.014z" fill="#121313" id="Close"></path></svg></span>\t\t\t\t\t\t\t</header>\t\t\t\t\t\t\t<div id="lumise-list-colors-body">\t\t\t\t\t\t\t\t<img src="'+LumiseDesign.assets+'assets/images/loading.gif" height="36" style="margin-top: 200px;" />\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t</div>'),t.ajax({url:LumiseDesign.ajax,method:"POST",data:{nonce:"LUMISE_ADMIN:"+LumiseDesign.nonce,ajax:"backend",action:"list_colors"},statusCode:{403:function(){alert(LumiseDesign.js_lang.error_403)}},success:function(t){n(t.split(","))}}),a.preventDefault()},clear_color:function(e){confirm(LumiseDesign.js_lang.sure)&&t(this).closest(".lumise-field-color-wrp").find("li[data-color]").remove(),e.preventDefault()},return_colors:function(t){var a=t.find('input[data-el="select"]').val(),i=t.find("li.choosed[data-color]"),n=[];i.get(0)&&(a=i.attr("data-color")),t.find("li[data-color]").each((function(){n.push(this.getAttribute("data-color")+"@"+this.getAttribute("data-label"));var t=decodeURIComponent(this.getAttribute("data-label")).replace(/\"/g,"");""===t&&(t=void 0!==e[this.getAttribute("data-color")]?e[this.getAttribute("data-color")]:this.getAttribute("data-color")),this.setAttribute("title",t)})),n=a+":"+n.join(","),t.find('input[data-el="hide"]').val(n)},do_submit:function(){t(this).closest("form").submit()},check_submit:function(t){return!0},google_fonts:function(e){var a=t(this),n=t(e.target);switch(act=n.attr("data-act")?n.attr("data-act"):n.closest("[data-act]").attr("data-act"),act){case"delete":n.closest("li").remove();var s={};a.find("li").each((function(){s[this.getAttribute("data-n")]=[this.getAttribute("data-f"),this.getAttribute("data-s")]})),a.find('textarea[data-func="value"]').val(JSON.stringify(s));break;case"add":i({content:'<iframe src="https://services.lumise.com/fonts/?mode=select"></iframe>'}),t("#lumise-lightbox iframe").on("load",(function(){this.contentWindow.postMessage({action:"fonts",fonts:a.find('textarea[data-func="value"]').val()},"*")})),e.preventDefault()}},report_bug:function(e){e.preventDefault(),t(this).after('<i class="fa fa-spinner fa-spin fa-2x fa-fw margin-bottom"></i>');var a=this.parentNode;t(this).remove(),t.ajax({url:LumiseDesign.ajax,method:"POST",data:{nonce:"LUMISE_ADMIN:"+LumiseDesign.nonce,ajax:"backend",action:"report_bug",id:this.getAttribute("data-id")},statusCode:{403:function(){alert(LumiseDesign.js_lang.error_403)}},success:function(t){a.innerHTML=JSON.stringify(t)}})}},"general_events"),t("input.lumise-upload-helper-inp").eq(0).closest("form").on("submit",(function(t){if(!n())return t.preventDefault(),!1})),t(".lumise_set_price").on("change",(function(e){e.preventDefault();var a={type:t(this).attr("data-type"),id:t(this).attr("data-id"),value:t(this).val()},i=t(this);t.ajax({url:LumiseDesign.ajax,method:"POST",data:{action:"lumise_set_price",nonce:"LUMISE_ADMIN:"+LumiseDesign.nonce,data:a},dataType:"json",statusCode:{403:function(){alert(LumiseDesign.js_lang.error_403)}},success:function(t){if("success"==t.status){var e=jQuery('<span class="set_success">'+lumise.i(79)+"</span>");i.parent().append(e),i.val(t.value),setTimeout((function(){e.remove()}),600)}else{e=jQuery('<span class="set_error">'+lumise.i(97)+"</span>");i.parent().append(e),setTimeout((function(){e.remove()}),600)}}})})),t((function(){t.widget("custom.combobox",{_create:function(){this.wrapper=t("<div>").addClass("lumise-combobox").insertAfter(this.element),this.element.hide(),this._createAutocomplete(),this._createShowAllButton()},_createAutocomplete:function(){var e=this.element.children(":selected"),a=e.val()?e.text():"";this.input=t("<input>").appendTo(this.wrapper).val(a).addClass("lumise-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left").autocomplete({delay:0,minLength:0,source:t.proxy(this,"_source")}).tooltip({classes:{"ui-tooltip":"ui-state-highlight"}}),this._on(this.input,{autocompleteselect:function(t,e){e.item.option.selected=!0,this._trigger("select",t,{item:e.item.option})},autocompletechange:"_removeIfInvalid"})},_createShowAllButton:function(){var e=this.input,a=!1;t("<a>").attr("tabIndex",-1).tooltip().appendTo(this.wrapper).removeClass("ui-corner-all").addClass("lumise-combobox-toggle ui-corner-right").on("mousedown",(function(){a=e.autocomplete("widget").is(":visible")})).on("click",(function(){e.trigger("focus"),a||e.autocomplete("search","")}))},_source:function(e,a){var i=new RegExp(t.ui.autocomplete.escapeRegex(e.term),"i");a(this.element.children("option").map((function(){var a=t(this).text();if(this.value&&(!e.term||i.test(a)))return{label:a,value:a,option:this}})))},_removeIfInvalid:function(e,a){if(!a.item){var i=this.input.val().toLowerCase(),n=!1;this.element.children("option").each((function(){if(t(this).text().toLowerCase()===i)return this.selected=n=!0,!1})),n||(this.input.val("").tooltip("open"),this.element.val(""),this._delay((function(){this.input.tooltip("close").attr("title","")}),2500),this.input.autocomplete("instance").term="")}},_destroy:function(){this.wrapper.remove(),this.element.show()}}),t(".lumise_currency").combobox()})),t((function(){function e(t){return t.split(/,\s*/)}t("#tags").on("keydown",(function(e){e.keyCode===t.ui.keyCode.TAB&&t(this).autocomplete("instance").menu.active&&e.preventDefault()})).autocomplete({minLength:0,source:function(a,i){void 0!==window.lumise_tag_values&&i(t.ui.autocomplete.filter(lumise_tag_values,e(a.term).pop()))},focus:function(){return!1},select:function(t,a){var i=e(this.value);return i.pop(),i.push(a.item.value),i.push(""),this.value=i.join(", "),!1}})})),void 0!==window.lumise_sampleTags&&t(".tagsfield").tagit({availableTags:lumise_sampleTags,autocomplete:{delay:0,minLength:2},removeConfirmation:!0,afterTagAdded:function(e,a){var i={type:t(this).attr("data-type"),id:t(this).attr("data-id"),value:a.tag.find(".tagit-label").html()},n=t(this);a.duringInitialization||t.ajax({url:LumiseDesign.ajax,method:"POST",data:{action:"add_tags",nonce:"LUMISE_ADMIN:"+LumiseDesign.nonce,data:i},dataType:"json",statusCode:{403:function(){alert(LumiseDesign.js_lang.error_403)}},success:function(t){if("success"==t.status){var e=jQuery('<span class="set_success">'+lumise.i(79)+"</span>");n.parent().append(e),setTimeout((function(){e.remove()}),600)}else{e=jQuery('<span class="set_error">'+lumise.i(97)+"</span>");n.parent().append(e),setTimeout((function(){e.remove()}),600)}}})},beforeTagRemoved:function(e,a){var i={type:t(this).attr("data-type"),id:t(this).attr("data-id"),value:a.tag.find(".tagit-label").html()},n=t(this);t.ajax({url:LumiseDesign.ajax,method:"POST",data:{action:"remove_tags",nonce:"LUMISE_ADMIN:"+LumiseDesign.nonce,data:i},dataType:"json",statusCode:{403:function(){alert(LumiseDesign.js_lang.error_403)}},success:function(t){if("success"==t.status){var e=jQuery('<span class="set_success">'+lumise.i(79)+"</span>");n.parent().append(e),setTimeout((function(){e.remove()}),600)}else{e=jQuery('<span class="set_error">'+lumise.i(97)+"</span>");n.parent().append(e),setTimeout((function(){e.remove()}),600)}}})}}),t(".lumise_sub_menu.open").each((function(){var e=0;t(this).find("li").each((function(a){e+=t(this).outerHeight()})),t(this).css({height:e})})),t(".lumise_backtotop").length>0&&(t(window).scroll((function(){t(window).scrollTop()>250?t(".lumise_backtotop").addClass("show"):t(".lumise_backtotop").removeClass("show")})),t(".lumise_backtotop").click((function(){t("body,html").animate({scrollTop:0},500)}))),t(".lumise_tab_nav").each((function(){var e=t(this).closest(".lumise_tabs_wrapper"),a=localStorage.getItem("LUMISE-TABS"),i=e.attr("data-id");a=a?JSON.parse(a):{},""!==i&&a[i]&&0!==t(this).find('a[href="'+a[i]+'"]').length?t(this).find('a[href="'+a[i]+'"]').first().trigger("click"):t(this).find("a").first().trigger("click")})),t(".lumise_checkboxes").sortable({start:function(e,a){var i=t(a.item[0]).parent();i.css({"min-height":0}),i.css({"min-height":i.height()})}}).find('.field_children input[type="radio"]').on("change",(function(){t(this).closest("div.lumise_checkbox").find("input.action_check").prop({checked:!0})})),document.lumiseconfig&&lumise[document.lumiseconfig.main]&&lumise[document.lumiseconfig.main].init(document.lumiseconfig),document.getElementById("lumise-rss-display")&&t.ajax({url:LumiseDesign.ajax,method:"POST",data:{action:"get_rss",nonce:"LUMISE_ADMIN:"+LumiseDesign.nonce},statusCode:{403:function(){alert(LumiseDesign.js_lang.error_403)}},success:function(t){document.getElementById("lumise-rss-display").innerHTML=t}})})),window.lumise_font_preview=function(e,a,i){t("#font-ttf-upload").show();try{document.fonts.check("1px "+e)?t(i).css({fontFamily:e,display:"inline-block"}).html("Font Preview"):new FontFace(e,a).load("1px "+e,"a").then((function(a){document.fonts.add(a),t(i).css({fontFamily:e,display:"inline-block"}).html("Font Preview")}))}catch(a){t(i).css({fontFamily:e,display:"inline-block"}).html("Font Preview")}},window.addEventListener("message",(function(e){if("https://services.lumise.com"==e.origin&&e.data&&e.data.action)switch(e.data.action){case"fonts":t('.lumise-field-google_fonts textarea[data-func="value"]').val(JSON.stringify(e.data.fonts));var a,i="";Object.keys(e.data.fonts).map((function(t){a=decodeURIComponent(t).replace(/\ /g,"+")+":"+e.data.fonts[t][1],i+='<li data-n="'+t+'" data-f="'+e.data.fonts[t][0]+'" data-s="'+e.data.fonts[t][1]+'">',i+='<link rel="stylesheet" href="//fonts.googleapis.com/css?family='+a+'" />',i+='<font style="font-family: '+decodeURIComponent(t)+';">'+decodeURIComponent(t)+"</font>",i+='<delete data-act="delete">Delete</delete>',i+="</li>"})),t(".lumise-field-google_fonts").find("ul").html(i)}})),t.fn.shake=function(){return this.focus().animate({marginLeft:-30},100).animate({marginLeft:20},100).animate({marginLeft:-10},100).animate({marginLeft:5},100).animate({marginLeft:0},100)},e=jQuery.fn.clone,jQuery.fn.clone=function(){for(var a=e.apply(this,arguments),i=this.find("textarea").add(this.filter("textarea")),n=a.find("textarea").add(a.filter("textarea")),s=this.find("select").add(this.filter("select")),l=a.find("select").add(a.filter("select")),o=0,d=i.length;o<d;++o)t(n[o]).val(t(i[o]).val());for(o=0,d=s.length;o<d;++o)l[o].selectedIndex=s[o].selectedIndex;return a}}(jQuery),window.HERMITE=new Hermite_class;