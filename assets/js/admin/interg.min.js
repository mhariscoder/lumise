jQuery(document).ready((function(t){var e={},s=function(t){var e;for(var s in t.events){if("function"==typeof t.events[s])e=t.events[s];else{if("function"!=typeof t[t.events[s]])continue;e=t[t.events[s]]}(s=s.split(",")).map((function(s){void 0===(s=s.split(":"))[1]&&(s[1]="click"),""===s[0]?t.el.off(s[1]).on(s[1],t,e):t.el.find(s[0]).off(s[1]).on(s[1],t,e)}))}},i=function(e){if("close"==e)return t("body").css({overflow:""}),t("#lumise-lightbox").remove();var s='<div id="lumise-lightbox" class="lumise-lightbox" style="display:block">\t\t\t\t\t\t\t<div id="lumise-lightbox-body">\t\t\t\t\t\t\t\t<div id="lumise-lightbox-content" class="%class%" style="min-width:%width%px">\t\t\t\t\t\t\t\t\t%content%\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t%footer%\t\t\t\t\t\t\t\t<a class="kalb-close" href="#close" title="Close">\t\t\t\t\t\t\t\t\t<i class="dashicons dashicons-no-alt"></i>\t\t\t\t\t\t\t\t</a>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="kalb-overlay"></div>\t\t\t\t\t\t</div>',i=t.extend({width:1e3,class:"",footer:"",content:"",onload:function(){},onclose:function(){}},e);""!==i.footer&&(i.footer='<div id="lumise-lightbox-footer">'+i.footer+"</div>"),s=t(s.replace(/\%width\%/g,i.width).replace(/\%class\%/g,i.class).replace(/\%content\%/g,i.content).replace(/\%footer\%/g,i.footer)),t(".lumise-lightbox").remove(),t("body").append(s).css({overflow:"hidden"}),i.onload(s),s.find("a.kalb-close,div.kalb-overlay").on("click",(function(e){i.onclose(s),t(".lumise-lightbox").remove(),t("body").css({overflow:""}),e.preventDefault()}))},a=function(i){e=i;var l=['<ul data-view="categories">',"<h3>"+lumisejs._i56+"</h3>",'<li data-id="" '+(""===i.category?'class="active"':"")+' data-lv="0"> '+lumisejs._i57+"</li>"],n=['<h3 data-view="top"><input type="search" value="'+i.s+'" placeholder="'+lumisejs._i63+'" />'+(u.products.cfg.can_create_new?'<a href="#new-product"><i class="dashicons dashicons-plus"></i> '+lumisejs._i59+"</a>":"")+"</h3>",'<ul data-view="items">'];if(i.categories&&i.categories.map((function(t){l.push("<li "+(i.category==t.id?'class="active"':"")+' data-id="'+t.id+'" data-lv="'+t.lv+'">'+"&mdash;".repeat(t.lv)+" "+t.name+"</li>")})),i.products&&i.products.length>0?i.products.map((function(e){try{var s=JSON.parse(decodeURIComponent(atob(e.stages)))}catch(t){s={}}try{var i=JSON.parse(decodeURIComponent(atob(e.attributes)))}catch(t){i={}}var a=lumisejs.color;void 0!==s.stages&&(s=s.stages),Object.keys(i).map((function(t){if("product_color"==i[t].type&&""!==i[t].values&&null!==i[t].values)try{"string"==typeof i[t].values&&(i[t].values=JSON.parse(i[t].values)),a=i[t].values.options[0].value,i[t].values.options.map((function(t){t.default&&(a=t.value)}))}catch(t){}}));var l=s["colors"!==Object.keys(s)[0]?Object.keys(s)[0]:Object.keys(s)[1]],o=t("#lumise_product_base").val(),d="";d=void 0===l.source||"raws"==l.source?lumisejs.assets_url+"assets/raws/"+l.url:lumisejs.upload_url+l.url,n.push('<li data-id="'+e.id+'"'+(o==e.id?' data-current="true"':"")+' data-name="'+e.name.toLowerCase().trim().replace(/[^a-z0-9 ]/gim,"")+'">\t\t\t\t\t\t\t<span data-view="thumbn" data-start="'+u.products.cfg.action_text+'">\t\t\t\t\t\t\t\t<img style="background: '+(l.color?l.color:a)+'" src="'+d+'" />\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t<span data-view="name">'+e.name+"</span>\t\t\t\t\t\t</li>")})):n.push('<li data-view="noitem">'+lumisejs._i42+"</li>"),i.limit<i.total){for(var d=['<li data-view="pagination">',"<ul>"],r=Math.ceil(i.total/i.limit),c=Math.ceil(i.index/i.limit),p=1;p<=r;p++)d.push('<li data-page="'+p+'" '+(c==p?' class="lumise-color"':"")+">"+p+"</li>");d.push("</ul></li>"),n.push(d.join(""))}t("#lumise-lightbox-content").html('<div id="lumise-list-items-wrp"></div>'),t("#lumise-list-items-wrp").html(l.join("")).append(n.join("")),s({el:t("#lumise-list-items-wrp"),events:{'ul[data-view="categories"] li':"category",'ul[data-view="items"] li[data-id]':"product",'h3[data-view="top"] input:keyup':"search",'h3[data-view="top"] a[href="#new-product"]':"new_product",'li[data-view="pagination"] li[data-page]':"page"},category:function(){t(this).closest("#lumise-change-products-wrp");var s=this.getAttribute("data-id");t("#lumise-list-items-wrp").css({background:"#f2f2f2"}).html('<center><i class="lumise-spinner x3"></i></center>'),u.products.query.s=e.s,u.products.query.category=s,u.products.query.index=0,t.ajax({url:lumisejs.admin_ajax_url,method:"POST",data:u.products.query,statusCode:{403:function(){alert("Error 403")}},success:function(t){u.products.res=t,a(u.products.res)}})},product:function(e){let s=this.getAttribute("data-id"),i=u.products.res.products.filter((function(t){return t.id==s}));if(t(this).closest("#lumise-lightbox").remove(),t("body").css({overflow:""}),"function"==typeof u.products.cfg.action_fn)return u.products.cfg.action_fn(i[0]);t("#lumise_product_base").val(i[0].id),o(i[0]),u.current_product=i[0].id,t("#_regular_price").length>0&&""===t("#_regular_price").val()&&t("#_regular_price").val(10)},new_product:function(e){t("#lumise-lightbox-content").addClass("full-screen").html('<iframe src="'+lumisejs.admin_url+'&lumise-page=product&callback=edit-cms-product"></iframe>')},search:function(s){13===s.keyCode&&(t("#lumise-list-items-wrp").css({background:"#f2f2f2"}).html('<center><i class="lumise-spinner x3"></i></center>'),u.products.query.s=this.value.toLowerCase(),u.products.query.category=e.category?e.category:"",u.products.query.index=0,t.ajax({url:lumisejs.admin_ajax_url,method:"POST",data:u.products.query,statusCode:{403:function(){alert("Error 403")}},success:function(t){u.products.res=t,a(u.products.res)}}),s.preventDefault())},page:function(s){var i=parseInt(this.getAttribute("data-page"));t("#lumise-list-items-wrp").css({background:"#f2f2f2"}).html('<center><i class="lumise-spinner x3"></i></center>');var l=parseInt(e.limit);isNaN(l)&&(l=2),u.products.query.s=e.s?e:"",u.products.query.category=e.category?e.category:"",u.products.query.index=i*l-l,t.ajax({url:lumisejs.admin_ajax_url,method:"POST",data:u.products.query,statusCode:{403:function(){alert("Error 403")}},success:function(t){u.products.res=t,a(u.products.res)}}),s.preventDefault()}})},l=function(e){var i=['<ul data-view="categories">',"<h3>"+lumisejs._i56+"</h3>",'<li data-id="" '+(""===e.category?'class="active"':"")+' data-lv="0"> '+lumisejs._i57+"</li>"],a=['<h3 data-view="top"><input id="search-templates-inp" type="search" placeholder="'+lumisejs._i67+'" value="'+encodeURIComponent(e.q)+'" /></h3>','<ul data-view="items">'];e.categories_full&&e.categories_full.map((function(t){i.push('<li data-id="'+t.id+'" '+(t.id==e.category?'class="active"':"")+' data-lv="'+(t.lv?t.lv:0)+'">'+"&mdash;".repeat(t.lv)+" "+t.name+"</li>")})),e.items&&e.items.length>0?(e.items.map((function(t){a.push('<li data-id="'+t.id+'"'+(u.current_design==t.id?' data-current="true"':"")+'>\t\t\t\t\t\t\t<span data-view="thumbn" data-start="'+lumisejs._i58+'">\t\t\t\t\t\t\t\t<img src="'+(t.screenshot.match(/^(?:http|https):\/\//gm)?t.screenshot:lumisejs.upload_url+t.screenshot)+'" />\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t<span data-view="name">'+t.name+"</span>\t\t\t\t\t\t</li>")})),e.index+e.limit<e.total&&a.push('<li data-loadmore="'+(e.index+e.limit)+'">\t\t\t\t\t\t\t<span>'+lumisejs._i68+"</span>\t\t\t\t\t\t</li>")):a.push('<li data-view="noitem" data-category="'+e.category+'">'+lumisejs._i42+"</li>"),0==e.index?(u.designs=e.items,i.push("</ul>"),a.push("</ul>"),t("#lumise-lightbox-content").html('<div id="lumise-list-items-wrp"></div>'),t("#lumise-list-items-wrp").html(i.join("")).append(a.join(""))):(u.designs=u.designs.concat(e.items),t('#lumise-lightbox-content ul[data-view="items"] li[data-loadmore]').remove(),a[0]="",a[1]="",t('#lumise-lightbox-content ul[data-view="items"]').append(a.join(""))),s({el:t("#lumise-list-items-wrp"),events:{'ul[data-view="categories"] li':"category",'ul[data-view="items"] li[data-id]':"design",'h3[data-view="top"] input:keyup':"search","li[data-loadmore]":"load_more"},category:function(e){d({category:this.getAttribute("data-id"),index:0,q:t("#search-templates-inp").val()}),e.preventDefault()},design:function(e){var s=this.getAttribute("data-id"),i=u.designs.filter((function(t){return t.id==s}));t(this).closest("#lumise-lightbox").remove(),t("body").css({overflow:""}),n(i[0])},load_more:function(e){this.innerHTML='<i class="lumise-spinner x3"></i>',this.style.background="transparent",t(this).off("click"),d({category:this.getAttribute("data-category"),index:this.getAttribute("data-loadmore"),q:t("#search-templates-inp").val()})},search:function(t){void 0!==t.keyCode&&13===t.keyCode&&d({q:this.value})}})},o=function(e){if(window["lumise-seclect-base"].style.display="","string"==typeof e.stages)var a=JSON.parse(decodeURIComponent(atob(e.stages)));else a=e.stages;var l,o={},n="",u="",c="",p="",m=e.color?e.color:"#f0f0f0";if(void 0!==e.attributes&&""!==e.attributes){var f=JSON.parse(decodeURIComponent(atob(e.attributes)));Object.keys(f).map((function(t){if("product_color"==f[t].type&&""!==f[t].values)try{"string"==typeof f[t].values&&(f[t].values=JSON.parse(f[t].values)),f[t].values.options.length>0&&(m=f[t].values.options[0].value),f[t].values.options.map((function(t){t.default&&(m=t.value)}))}catch(t){console.log(t)}}))}"object"!=typeof a&&(a={});var h=void 0!==a.stages?a.stages:a;Object.keys(h).length>0&&(Object.keys(h).map((function(t,e){o=h[t],null!==(p=void 0!==lumisejs.current_design&&void 0!==lumisejs.current_design[t]?lumisejs.current_design[t]:null)&&(p.scr='<img src="'+(p.screenshot.match(/^(?:http|https):\/\//gm)?p.screenshot:lumisejs.upload_url+p.screenshot)+'" height="'+p.offset.natural_height+'" width="'+p.offset.natural_width+'" class="lumise-design-view" style="'+p.css+'" />'),l="raws"==o.source?lumisejs.assets_url+"assets/raws/"+o.url:lumisejs.upload_url+o.url,u+="<li"+(0==e?' class="active"':"")+'><a href="#lumise-tab-'+t+'">'+(o.label?o.label:lumisejs["_"+t])+"</a></li>",c+='<div class="lumise_tab_content'+(0==e?" active":"")+'" id="lumise-tab-'+t+'" data-stage="'+t+'">\t\t\t\t\t\t\t\t<div class="lumise-stage-settings lumise-product-design" id="lumise-product-design-'+t+'">\t\t\t\t\t\t\t\t\t<div class="lumise-stage-body">\t\t\t\t\t\t\t\t\t\t<div class="lumise-stage-design-view">\t\t\t\t\t\t\t\t\t\t\t<img style="background:'+m+'" src="'+l+'" width="'+o.product_width+'" height="'+o.product_height+'" class="lumise-stage-image" />\t\t\t\t\t\t\t\t\t\t\t<div class="lumise-stage-editzone" style="margin-left: '+o.edit_zone.left+"px;margin-top: "+o.edit_zone.top+"px;width: "+o.edit_zone.width+"px;height: "+o.edit_zone.height+"px;border-color: "+function(t){var e,s,i;if(void 0!==t&&t.indexOf("rgb")>-1)t=t.split(","),e=parseInt(t[0].trim()),s=parseInt(t[1].trim()),i=parseInt(t[2].trim());else if(void 0!==t){t.length<6&&(t+=t.replace("#",""));var a="#"==t.charAt(0)?t.substring(1,7):t.substring(0,6);e=parseInt(a.substring(0,2),16)/255*.213,s=parseInt(a.substring(2,4),16)/255*.715,i=parseInt(a.substring(4,6),16)/255*.072}return e+s+i<.5?"#DDD":"#333"}(m)+";border-radius:"+o.edit_zone.radius+'%">\t\t\t\t\t\t\t\t\t\t\t\t<div class="design-template-inner" data-id="'+(null!==p?p.id:"")+'" style="border-radius:'+o.edit_zone.radius+'%">'+(null!==p?p.scr:"")+'</div>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div class="lumise-stage-btn">\t\t\t\t\t\t\t\t\t\t\t<button class="lumise-button lumise-button-primary" data-func="select-design">\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-paint-brush"></i>\t\t\t\t\t\t\t\t\t\t\t\t'+lumisejs._i58+'\t\t\t\t\t\t\t\t\t\t\t</button> &nbsp; \t\t\t\t\t\t\t\t\t\t\t<button class="lumise-button lumise-button-link-delete'+(null===p?" hidden":"")+'" data-func="clear-design" title="'+lumisejs._i69+'">\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-trash"></i>\t\t\t\t\t\t\t\t\t\t\t\t'+lumisejs._i70+'\t\t\t\t\t\t\t\t\t\t\t</button> &nbsp; \t\t\t\t\t\t\t\t\t\t\t<button class="lumise-button'+(null===p?" hidden":"")+'" data-func="download-design" title="'+lumisejs._i73+'">\t\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-download"></i>\t\t\t\t\t\t\t\t\t\t\t\t'+lumisejs._i72+'\t\t\t\t\t\t\t\t\t\t\t</button>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t<div class="editzone-ranges'+(null!==p?"":" hidden")+'">\t\t\t\t\t\t\t\t\t\t\t<div class="edr-row design-scale" style="">\t\t\t\t\t\t\t\t\t\t\t\t<label>Design scale:</label>\t\t\t\t\t\t\t\t\t\t\t\t<input type="range" min="10" max="200" value="'+(null!==p?p.scale:"")+'">\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>'})),n='<div class="lumise_tabs_wrapper" id="lumise-stages-wrp" data-id="stages">\t\t\t\t\t\t\t'+(!0===lumisejs.inline_edit?'<span data-view="product-name">\t\t\t\t\t\t\t<a title="'+e.name+'" href="'+lumisejs.admin_url+"&lumise-page=product&id="+e.id+'&callback=edit-base-product" data-func="edit-base-product" class="lumise-button" title="'+lumisejs._i61+'">\t\t\t\t\t\t\t\t<i class="fa fa-pencil"></i> \t\t\t\t\t\t\t\t'+lumisejs._i61+"\t\t\t\t\t\t\t</a>\t\t\t\t\t\t</span>":"")+'\t\t\t\t\t\t\t<div class="lumise_tab_nav_wrap">\t\t\t\t\t\t\t\t<i data-move="left" class="fa fa-chevron-left"></i>\t\t\t\t\t\t\t\t<div class="lumise_tab_nav_inner">\t\t\t\t\t\t\t\t\t'+(u='<ul class="lumise_tab_nav">'+u+"</ul>")+'\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<i data-move="right" class="fa fa-chevron-right"></i>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="lumise_tabs">'+c+"</div>\t\t\t\t\t\t</div>"),t("#lumise-product-base").html(n).addClass("set-product"),s({el:t("#lumise-product-base"),events:{'button[data-func="select-design"]':"select_design",'button[data-func="clear-design"]':"delete_design",'button[data-func="download-design"]':"download_design",'a[data-func="edit-base-product"]':"edit_product",'a[data-func="remove-base-product"]':"delete_product","ul.lumise_tab_nav li a":"tab",'.editzone-ranges .design-scale input[type="range"]:input':"design_scale","div.lumise_tab_nav_wrap":"is_stage_accord","div.lumise_tab_nav_wrap>i[data-move]":"stage_accord"},select_design:function(t){t.preventDefault(),d({category:"",index:0,s:""})},delete_design:function(e){e.preventDefault(),t(this).addClass("hidden").parent().find('button[data-func="download-design"]').addClass("hidden").closest(".lumise-stage-body").find(".lumise-stage-editzone .design-template-inner").html("").attr({"data-id":""}).closest(".lumise-stage-body").find(".editzone-ranges").addClass("hidden"),r()},download_design:function(e){e.preventDefault();var s=document.createElement("canvas"),i=document.createElement("canvas"),a=t(this).closest(".lumise-stage-body").find("img.lumise-stage-image").get(0),l=t(this).closest(".lumise-stage-body").find("img.lumise-design-view").get(0),o=t(this).closest(".lumise-stage-body").find(".lumise-stage-editzone").get(0),n=s.getContext("2d"),d=i.getContext("2d"),r=a.width/a.naturalWidth;s.width=a.naturalWidth,s.height=a.naturalHeight,i.width=o.offsetWidth/r,i.height=o.offsetHeight/r,n.fillStyle=a.style.backgroundColor,n.fillRect(0,0,s.width,s.height),d.drawImage(l,l.offsetLeft/r,l.offsetTop/r,l.width/r,l.height/r);var u=parseFloat(o.style.marginTop.replace("px",""))/r,c=parseFloat(o.style.marginLeft.replace("px",""))/r,p=c+=s.width/2-i.width/2,m=u+=s.height/2-i.height/2,f=i.width,h=i.height,g=parseInt(o.style.borderRadius.replace("px",""));n.save(),n.beginPath(),n.moveTo(p+g,m),n.lineTo(p+f-g,m),n.quadraticCurveTo(p+f,m,p+f,m+g),n.lineTo(p+f,m+h-g),n.quadraticCurveTo(p+f,m+h,p+f-g,m+h),n.lineTo(p+g,m+h),n.quadraticCurveTo(p,m+h,p,m+h-g),n.lineTo(p,m+g),n.quadraticCurveTo(p,m,p+g,m),n.closePath(),n.clip(),n.drawImage(i,p,m,f,h),n.restore(),n.drawImage(a,0,0);for(var v=s.toDataURL("image/jpeg",1).split(","),_=atob(v[1]),b=_.length,w=new Uint8Array(b),y=0;y<b;y++)w[y]=_.charCodeAt(y);var x=new Blob([w],{type:v[0].substring(v[0].indexOf("image/"),v[0].indexOf(";")-1)}),j=document.createElement("a"),k=t('#lumise-stages-wrp [data-func="edit-base-product"]').attr("title");k+="-"+t("#lumise-stages-wrp ul.lumise_tab_nav li.active a").text(),j.download=k+".jpg",j.href=URL.createObjectURL(x),j.click(),URL.revokeObjectURL(j.href),delete j,delete x,delete s,delete i},edit_product:function(t){i({content:'<iframe src="'+this.getAttribute("href")+'"></iframe>',class:"full-width"}),t.preventDefault()},delete_product:function(e){t("#lumise_product_base, #lumise_design_template").val(""),t("#lumise-product-base").html("").removeClass("set-product"),e.preventDefault()},tab:function(e){var s=t(this).closest("div#lumise-stages-wrp");s.find("div.lumise_tab_content.active, ul.lumise_tab_nav li.active").removeClass("active"),t(this).parent().addClass("active"),s.find(this.getAttribute("href")).addClass("active"),e.preventDefault()},design_scale:function(e){var s=t(this).closest(".lumise-stage-body").find(".design-template-inner img");if(0===s.length)return;var i=s.get(0),a=parseFloat(this.value),l=i.naturalWidth,o=i.naturalHeight,n=parseFloat(i.style.width.replace("px","")),d=parseFloat(i.style.height.replace("px","")),r=parseFloat(i.style.left.replace("px","")),u=parseFloat(i.style.top.replace("px",""));a&&!isNaN(a)||(a=1),isNaN(n)&&(n=i.offsetWidth),isNaN(d)&&(d=i.offsetHeight),isNaN(u)&&(u=i.offsetTop),isNaN(r)&&(r=i.offsetLeft);let c=l*a/100,p=o*a/100,m=(c-n)/2,f=(p-d)/2;s.css({width:c+"px",height:p+"px",left:r-m+"px",top:u-f+"px"})},is_stage_accord:function(e){var s=t(this),i=s.find("ul.lumise_tab_nav"),a=s.find("div.lumise_tab_nav_inner"),l=i.find("li.active");i.width()>a.width()?(s.addClass("is_accord"),i.get(0).offsetLeft+i.width()<.5*a.width()&&i.css({left:a.width()-i.width()+"px"})):(s.removeClass("is_accord"),i.css({left:"0px"})),void 0===this.first_time&&l&&l.get(0).offsetLeft>a.parent().width()&&i.css({left:-l.get(0).offsetLeft+(a.width()-l.width())+"px"}),this.first_time=!0},stage_accord:function(e){var s=this.getAttribute("data-move"),i=t(this.parentNode).find("div.lumise_tab_nav_inner"),a=i.find("ul.lumise_tab_nav"),l=i.width(),o=a.width(),n=parseFloat(a.css("left"));"left"==s&&n<0&&a.css({left:(n+.75*l<0?n+.75*l:0)+"px"}),"right"==s&&n>-(o-l)&&a.css({left:(n-.75*l>-(o-l)?n-.75*l:-(o-l))+"px"})}}),t("body").css({overflow:""}),t("#lumise_product_base").val(e.id),t('#lumise-enable-customize, #lumise_product_data a[data-func="remove-base-product"]').removeClass("hidden"),t("#lumise-product-base .lumise_tab_nav_wrap").trigger("click")},n=function(e,s){var i=t(void 0!==s?'#lumise-product-base .lumise_tabs .lumise_tab_content[data-stage="'+s+'"]':"#lumise-product-base .lumise_tabs .lumise_tab_content.active");if(0!==i.length){var a=new Image;a.src=e.screenshot.match(/^(?:http|https):\/\//gm)?e.screenshot:lumisejs.upload_url+e.screenshot,a.className="lumise-design-view",i.find('.lumise-stage-btn button[data-func="clear-design"],.lumise-stage-btn button[data-func="download-design"]').removeClass("hidden"),i.find(".design-template-inner").css({"border-radius":i.find(".lumise-stage-editzone").css("border-radius")}).attr({"data-id":e.id}).html("").append(a),a.onload=function(){this.width>this.parentNode.offsetWidth&&(this.width=this.parentNode.offsetWidth,this.height=this.parentNode.offsetWidth*(this.naturalHeight/this.naturalWidth)),this.style.left=this.parentNode.offsetWidth/2-this.width/2+"px",this.style.top=this.parentNode.offsetHeight/2-this.height/2+"px";var e=t(this).closest(".lumise-stage-body").find(".editzone-ranges");e.removeClass("hidden"),e.find("input").val(this.width/this.naturalWidth*100).trigger("input")}}},d=function(e){void 0!==e.index&&0!==e.index||i({content:'<center><i class="lumise-spinner x3"></i></center>'}),t.ajax({url:lumisejs.admin_ajax_url,method:"POST",data:{nonce:"LUMISE-SECURITY-BACKEND:"+lumisejs.nonce_backend,ajax:"backend",action:"templates",category:void 0!==e.category?e.category:"",q:void 0!==e.q?e.q:"",index:void 0!==e.index?e.index:0},statusCode:{403:function(){alert("Your session has expired, please reload the page!")}},success:l})},r=function(){if(""!==t("#lumise_product_base").val()){var e={};t("#lumise_product_data .lumise_tabs .lumise_tab_content").each((function(){var s=t(this),i=s.find(".design-template-inner img").get(0);s.css({display:"inline-block"}),void 0!==i&&(e[this.getAttribute("data-stage")]={id:s.find(".design-template-inner").data("id"),scale:s.find(".design-scale input").val(),css:s.find(".design-template-inner img").attr("style"),offset:{top:i.offsetTop,left:i.offsetLeft,width:i.offsetWidth,height:i.offsetHeight,natural_width:i.naturalWidth,natural_height:i.naturalHeight},screenshot:s.find(".design-template-inner img").attr("src")}),s.css({display:""})})),lumisejs.current_design=e,t("#lumise_design_template").val(encodeURIComponent(JSON.stringify(e)))}else t("#lumise_design_template").val("")},u={designs:[],products:{query:{},cfg:{}}};window.lumise_reset_products=function(e){delete u.products.res,t("#lumise-lightbox").remove(),t("#lumise_product_base").val(e.id),r(),o(e)},window.load_product_bases=function(e,s){if(i({content:'<center><i class="lumise-spinner x3"></i></center>'}),u.products.query={nonce:"LUMISE-SECURITY-BACKEND:"+lumisejs.nonce_backend,ajax:"backend",action:"list_products",task:"cms_product",s:"",category:"",index:0},u.products.cfg={can_create_new:!0,action_text:lumisejs._i64},null!=e&&"object"==typeof e&&(u.products.query=t.extend(!0,u.products.query,e),delete u.products.res),null!=s&&"object"==typeof s&&(u.products.cfg=t.extend(!0,u.products.cfg,s)),void 0!==u.products.res)return a(u.products.res);t.ajax({url:lumisejs.admin_ajax_url,method:"POST",data:u.products.query,statusCode:{403:function(){alert("Error 403")}},success:function(t){u.products.res=t,a(u.products.res)}})},s({el:t("#lumise_product_data"),events:{'a[data-func="products"]':"products",'a[data-func="remove-base-product"]':"remove_product","#lumise-product-base:mousedown":"start_drag"},products:function(t){t.preventDefault(),load_product_bases()},remove_product:function(e){t('#lumise-enable-customize, #lumise_product_data a[data-func="remove-base-product"]').addClass("hidden"),t("#lumise-product-base").html('<p class="notice notice-warning">'+lumisejs._i71+"</p>"),t("#lumise_product_base, #lumise_design_template").val(""),t("html,body").animate({scrollTop:t("#lumise_product_data").offset().top-100}),e.preventDefault()},start_drag:function(e){if("IMG"==e.target.tagName&&"lumise-design-view"==e.target.className){var s=t(e.target),i=e.clientX,a=e.clientY,l=e.target.offsetLeft,o=e.target.offsetTop,n=e.target.offsetWidth,d=e.target.offsetHeight;t(document).on("mousemove",(function(t){var e=s.parent().width();ph=s.parent().height(),new_left=l+(t.clientX-i),new_top=o+(t.clientY-a),new_left<.85*-n&&(new_left=.85*-n),new_top<.85*-d&&(new_top=.85*-d),new_left>e-.15*n&&(new_left=e-.15*n),new_top>ph-.15*d&&(new_top=ph-.15*d),s.css({left:new_left+"px",top:new_top+"px"})})),t(document).on("mouseup",(function(){t(document).off("mousemove mouseup")})),e.preventDefault()}}}),t("#lumise_product_data").closest("form").on("submit",r),t("#product-type").on("change",(function(e){"simple"==this.value?(t("ul.product_data_tabs li.lumise_options.lumise_tab, #lumise-seclect-base").show(),void 0!==window.lumisejs.current_data?o(lumisejs.current_data):(t("#lumise-product-base").html('<p class="notice notice-warning">'+lumisejs._i71+"</p>"),t('#lumise-enable-customize, #lumise_product_data a[data-func="remove-base-product"]').addClass("hidden")),t("#lumise_product_data").closest("div.dokan-other-options.dokan-edit-row").show()):"variable"==this.value?(t("#lumise-product-base").html('<p class="notice notice-warning">This is variable product, Please set the Lumise Configuration in <a href="#" onclick="jQuery(\'li.variations_options a\').click();return false;">Variations Tab</a></p>'),t("#lumise-seclect-base").hide(),t("ul.product_data_tabs li.lumise_options.lumise_tab").show(),t("#lumise_product_data").closest("div.dokan-other-options.dokan-edit-row").hide()):(t("ul.product_data_tabs li.lumise_options.lumise_tab").hide(),t("#lumise_product_data").closest("div.dokan-other-options.dokan-edit-row").hide())})).change(),t("#product_type").on("change",(function(e){"simple"==this.value?t("#lumise_product_data").closest("div.dokan-other-options.dokan-edit-row").show():t("#lumise_product_data").closest("div.dokan-other-options.dokan-edit-row").hide()})).change(),t('select#field_to_edit option[value="delete_all"]').after('<option value="delete_all_lumise">Clear all Lumise Configuations</option>'),t("select#field_to_edit+a").on("click",(e=>{if("delete_all_lumise"==t("select#field_to_edit").val())return confirm("Are you sure that you want to clear all Lumise Configuations?")&&t("textarea.lumise-vari-inp").val(""),t("div.variable_lumise_data").attr("data-empty","true").removeAttr("is").find("iframe").remove(),t("div#woocommerce-product-data").append('<div class="UIloading blockUI blockOverlay" style="z-index: 1000; border: none; margin: 0px; padding: 0px; width: 100%; height: 100%; top: 0px; left: 0px; background: rgb(255, 255, 255); opacity: 0.6; cursor: wait; position: absolute;"></div>'),t.ajax({url:lumisejs.admin_ajax_url,method:"POST",data:{nonce:"LUMISE-SECURITY-BACKEND:"+lumisejs.nonce_backend,ajax:"backend",action:"product_variation",clear_all_config:window.post_ID.value},success:t=>{window.parent.jQuery("div#woocommerce-product-data div.UIloading").remove(),window.parent.jQuery("div#variable_product_options div.toolbar button").attr({disabled:"disabled"})}}),e.preventDefault(),!1}))}));